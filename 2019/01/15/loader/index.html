<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script>!function(e,t,o,c,i,a,n){e.DaoVoiceObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,a=t.createElement(o),n=t.getElementsByTagName(o)[0],a.async=1,a.src=c,a.charset="utf-8",n.parentNode.insertBefore(a,n)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/0f81ff2f.js","daovoice"),daovoice("init",{app_id:"4c4e88e0"}),daovoice("update")</script><script src="https://cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="keywords" content="webpack,loader,"><link rel="alternate" href="/atom.xml" title="大鹏的博客" type="application/atom+xml"><meta name="description" content="loader运行的总体流程(一个函数) loader配置loader是导出为一个函数的node模块。该函数在loader转换资源的时候调用。给定的函数将调用loader API(loaderContext)，并通过this上下文访问。 匹配(test)单个 loader匹配(test)单个 loader，你可以简单通过在 rule 对象设置 path.resolve 指向这个本地文件1234567"><meta name="keywords" content="webpack,loader"><meta property="og:type" content="article"><meta property="og:title" content="loader"><meta property="og:url" content="https://zhangyapeng0222.github.io/person_blogs/2019/01/15/loader/index.html"><meta property="og:site_name" content="大鹏的博客"><meta property="og:description" content="loader运行的总体流程(一个函数) loader配置loader是导出为一个函数的node模块。该函数在loader转换资源的时候调用。给定的函数将调用loader API(loaderContext)，并通过this上下文访问。 匹配(test)单个 loader匹配(test)单个 loader，你可以简单通过在 rule 对象设置 path.resolve 指向这个本地文件1234567"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://b.zhangyapeng.club/loader-2019115113541.jpg"><meta property="og:updated_time" content="2019-01-21T07:34:20.049Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="loader"><meta name="twitter:description" content="loader运行的总体流程(一个函数) loader配置loader是导出为一个函数的node模块。该函数在loader转换资源的时候调用。给定的函数将调用loader API(loaderContext)，并通过this上下文访问。 匹配(test)单个 loader匹配(test)单个 loader，你可以简单通过在 rule 对象设置 path.resolve 指向这个本地文件1234567"><meta name="twitter:image" content="http://b.zhangyapeng.club/loader-2019115113541.jpg"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://zhangyapeng0222.github.io/person_blogs/2019/01/15/loader/"><title>loader | 大鹏的博客</title><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?5bad22218259d1cb764a37744176e1bb";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>function loadCss(t){var s=document,i=s.head,o=s.createElement("link");o.rel="stylesheet",o.href=t,function t(i){if(s.body)return i();setTimeout(function(){t(i)})}(function(){i.appendChild(o)})}loadCss("/style.css"),loadCss("https://cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"),loadCss("//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"),loadCss("https://cdn.jsdelivr.net/npm/font-awesome@4.6.3/css/font-awesome.min.css")</script><style>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}::selection{background:#262a30;color:#fff}body{position:relative;font-family:Monda,"PingFang SC","Microsoft YaHei",sans-serif;font-size:14px;line-height:2;color:#555;background:#f5f7f9}@media (max-width:767px){body{padding-right:0!important}}@media (min-width:768px) and (max-width:991px){body{padding-right:0!important}}@media (min-width:1600px){body{font-size:16px}}h1,h2,h3,h4,h5,h6{margin:0;padding:0;font-weight:700;line-height:1.5;font-family:'Roboto Slab',Monda,"PingFang SC","Microsoft YaHei",sans-serif}h2,h3,h4,h5,h6{margin:20px 0 15px}h1{font-size:22px}@media (max-width:767px){h1{font-size:18px}}h2{font-size:20px}@media (max-width:767px){h2{font-size:16px}}h3{font-size:18px}@media (max-width:767px){h3{font-size:14px}}h4{font-size:16px}@media (max-width:767px){h4{font-size:12px}}h5{font-size:14px}@media (max-width:767px){h5{font-size:10px}}h6{font-size:12px}@media (max-width:767px){h6{font-size:8px}}p{margin:0 0 20px 0}a{color:#555;text-decoration:none;outline:0;border-bottom:1px solid #999;word-wrap:break-word}a:hover{color:#222;border-bottom-color:#222}blockquote{margin:0;padding:0}img{display:block;margin:auto;max-width:100%;height:auto}hr{margin:40px 0;height:3px;border:none;background-color:#ddd;background-image:repeating-linear-gradient(-45deg,#fff,#fff 4px,transparent 4px,transparent 8px)}blockquote{padding:0 15px;color:#666;border-left:4px solid #ddd}blockquote cite::before{content:"-";padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}kbd{border:1px solid #ccc;border-radius:.2em;box-shadow:.1em .1em .2em rgba(0,0,0,.1);background-color:#f9f9f9;font-family:inherit;background-image:-webkit-linear-gradient(top,#eee,#fff,#eee);padding:.1em .3em;white-space:nowrap}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.text-justify{text-align:justify}.text-nowrap{white-space:nowrap}.text-lowercase{text-transform:lowercase}.text-uppercase{text-transform:uppercase}.text-capitalize{text-transform:capitalize}.center-block{display:block;margin-left:auto;margin-right:auto}.clearfix:after,.clearfix:before{content:" ";display:table}.clearfix:after{clear:both}.pullquote{width:45%}.pullquote.left{float:left;margin-left:5px;margin-right:10px}.pullquote.right{float:right;margin-left:10px;margin-right:5px}.affix.affix.affix{position:fixed}.translation{margin-top:-20px;font-size:14px;color:#999}.scrollbar-measure{width:100px;height:100px;overflow:scroll;position:absolute;top:-9999px}.use-motion .motion-element{opacity:0}table{margin:20px 0;width:100%;border-collapse:collapse;border-spacing:0;border:1px solid #ddd;font-size:14px;table-layout:fixed;word-wrap:break-all}table>tbody>tr:nth-of-type(odd){background-color:#f9f9f9}table>tbody>tr:hover{background-color:#f5f5f5}caption,td,th{padding:8px;text-align:left;vertical-align:middle;font-weight:400}td,th{border-bottom:3px solid #ddd;border-right:1px solid #eee}th{padding-bottom:10px;font-weight:700}td{border-bottom-width:1px}body,html{height:100%}.container{position:relative;min-height:100%}.header-inner{margin:0 auto;padding:100px 0 70px;width:700px}@media (min-width:1600px){.container .header-inner{width:900px}}.main{padding-bottom:150px}.main-inner{margin:0 auto;width:700px}@media (min-width:1600px){.container .main-inner{width:900px}}.footer{position:absolute;left:0;bottom:0;width:100%;min-height:50px}.footer-inner{box-sizing:border-box;margin:20px auto;width:700px}@media (min-width:1600px){.container .footer-inner{width:900px}}.highlight,pre{overflow:auto;margin:20px 0;padding:0;font-size:13px;color:#ccc;background:#2d2d2d;line-height:1.6}code,pre{font-family:'PT Mono',consolas,Menlo,"PingFang SC","Microsoft YaHei",monospace}code{padding:2px 4px;word-wrap:break-word;color:#555;background:#eee;border-radius:3px;font-size:13px}pre{padding:10px}pre code{padding:0;color:#ccc;background:0 0;text-shadow:none}.highlight{border-radius:1px}.highlight pre{border:none;margin:0;padding:10px 0}.highlight table{margin:0;width:auto;border:none}.highlight td{border:none;padding:0}.highlight figcaption{font-size:1em;color:#ccc;line-height:1em;margin-bottom:1em}.highlight figcaption:after,.highlight figcaption:before{content:" ";display:table}.highlight figcaption:after{clear:both}.highlight figcaption a{float:right;color:#ccc}.highlight figcaption a:hover{border-bottom-color:#ccc}.highlight .gutter pre{padding-left:10px;padding-right:10px;color:#999;text-align:right;background-color:#1b1b1b}.highlight .code pre{width:100%;padding-left:10px;padding-right:10px;background-color:#2d2d2d}.highlight .line{height:20px}.gutter{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.gist table{width:auto}.gist table td{border:none}pre .deletion{background:green}pre .addition{background:maroon}pre .meta{color:#c9c}pre .comment{color:#999}pre .attribute,pre .css .class,pre .css .id,pre .css .pseudo,pre .html .doctype,pre .regexp,pre .ruby .constant,pre .tag,pre .variable,pre .xml .doctype,pre .xml .pi,pre .xml .tag .title{color:#f2777a}pre .built_in,pre .command,pre .constant,pre .literal,pre .number,pre .params,pre .preprocessor{color:#f99157}pre .css .rules .attribute,pre .formula,pre .header,pre .inheritance,pre .number,pre .ruby .class .title,pre .ruby .symbol,pre .special,pre .string,pre .value,pre .xml .cdata{color:#9c9}pre .css .hexcolor,pre .title{color:#6cc}pre .coffeescript .title,pre .function,pre .javascript .title,pre .perl .sub,pre .python .decorator,pre .python .title,pre .ruby .function .title,pre .ruby .title .keyword{color:#69c}pre .javascript .function,pre .keyword{color:#c9c}.full-image.full-image.full-image.full-image{border:none;max-width:100%;width:auto;margin:20px auto 25px}@media (min-width:992px){.full-image.full-image.full-image.full-image{max-width:none;width:118%;margin:0 -9%}}.blockquote-center,.page-home .post-type-quote blockquote,.page-post-detail .post-type-quote blockquote{position:relative;margin:40px 0;padding:0;border-left:none;text-align:center}.blockquote-center::after,.blockquote-center::before,.page-home .post-type-quote blockquote::after,.page-home .post-type-quote blockquote::before,.page-post-detail .post-type-quote blockquote::after,.page-post-detail .post-type-quote blockquote::before{position:absolute;content:' ';display:block;width:100%;height:24px;opacity:.2;background-repeat:no-repeat;background-position:0 -6px;background-size:22px 22px}.blockquote-center::before,.page-home .post-type-quote blockquote::before,.page-post-detail .post-type-quote blockquote::before{top:-20px;background-image:url(../images/quote-l.svg);border-top:1px solid #ccc}.blockquote-center::after,.page-home .post-type-quote blockquote::after,.page-post-detail .post-type-quote blockquote::after{bottom:-20px;background-image:url(../images/quote-r.svg);border-bottom:1px solid #ccc;background-position:100% 8px}.blockquote-center div,.blockquote-center p,.page-home .post-type-quote blockquote div,.page-home .post-type-quote blockquote p,.page-post-detail .post-type-quote blockquote div,.page-post-detail .post-type-quote blockquote p{text-align:center}.post .post-body .group-picture img{box-sizing:border-box;padding:0 3px;border:none}.post .group-picture-row{overflow:hidden;margin-top:6px}.post .group-picture-row:first-child{margin-top:0}.post .group-picture-column{float:left}.page-post-detail .post-body .group-picture-column{float:none;margin-top:10px;width:auto!important}.page-post-detail .post-body .group-picture-column img{margin:0 auto}.page-archive .group-picture-container{overflow:hidden}.page-archive .group-picture-row{float:left}.page-archive .group-picture-row:first-child{margin-top:6px}.page-archive .group-picture-column{max-width:150px;max-height:150px}.post-body .note{position:relative;padding:15px;margin-bottom:20px;border:1px solid #eee;border-left-width:5px;border-radius:3px}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{margin-top:0;margin-bottom:0;border-bottom:initial;padding-top:0!important}.post-body .note blockquote:first-child,.post-body .note ol:first-child,.post-body .note p:first-child,.post-body .note pre:first-child,.post-body .note table:first-child,.post-body .note ul:first-child{margin-top:0}.post-body .note blockquote:last-child,.post-body .note ol:last-child,.post-body .note p:last-child,.post-body .note pre:last-child,.post-body .note table:last-child,.post-body .note ul:last-child{margin-bottom:0}.post-body .note.default{border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.primary{border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.info{border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.success{border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.warning{border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.danger{border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.post-body .label{display:inline;padding:0 2px;white-space:nowrap}.post-body .label.default{background-color:#f0f0f0}.post-body .label.primary{background-color:#efe6f7}.post-body .label.info{background-color:#e5f2f8}.post-body .label.success{background-color:#e7f4e9}.post-body .label.warning{background-color:#fcf6e1}.post-body .label.danger{background-color:#fae8eb}.post-body .tabs{position:relative;display:block;margin-bottom:20px;padding-top:10px}.post-body .tabs ul.nav-tabs{margin:0;padding:0;display:flex;margin-bottom:-1px}@media (max-width:413px){.post-body .tabs ul.nav-tabs{display:block;margin-bottom:5px}}.post-body .tabs ul.nav-tabs li.tab{list-style-type:none!important;margin:0 .25em 0 0;border-top:3px solid transparent;border-left:1px solid transparent;border-right:1px solid transparent}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab{margin:initial;border-top:1px solid transparent;border-left:3px solid transparent;border-right:1px solid transparent;border-bottom:1px solid transparent}}.post-body .tabs ul.nav-tabs li.tab a{outline:0;border-bottom:initial;display:block;line-height:1.8em;padding:.25em .75em;transition-duration:.2s;transition-timing-function:ease-out;transition-delay:0s}.post-body .tabs ul.nav-tabs li.tab a i{width:1.285714285714286em}.post-body .tabs ul.nav-tabs li.tab.active{border-top:3px solid #fc6423;border-left:1px solid #ddd;border-right:1px solid #ddd;background-color:#fff}@media (max-width:413px){.post-body .tabs ul.nav-tabs li.tab.active{border-top:1px solid #ddd;border-left:3px solid #fc6423;border-right:1px solid #ddd;border-bottom:1px solid #ddd}}.post-body .tabs ul.nav-tabs li.tab.active a{cursor:default;color:#555}.post-body .tabs .tab-content{background-color:#fff}.post-body .tabs .tab-content .tab-pane{border:1px solid #ddd;padding:20px 20px 0 20px}.post-body .tabs .tab-content .tab-pane:not(.active){display:none!important}.post-body .tabs .tab-content .tab-pane.active{display:block!important}.btn{display:inline-block;padding:0 20px;font-size:14px;color:#555;background:#fff;border:2px solid #555;text-decoration:none;border-radius:2px;transition-property:background-color;transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s;line-height:2}.btn:hover{border-color:#222;color:#fff;background:#222}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{width:1.285714285714286em;text-align:left}.btn-bar{display:block;width:22px;height:2px;background:#555;border-radius:1px}.btn-bar+.btn-bar{margin-top:4px}.pagination{margin:120px 0 40px;text-align:center;border-top:1px solid #eee}.page-number-basic,.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{display:inline-block;position:relative;top:-1px;margin:0 10px;padding:0 11px}@media (max-width:767px){.page-number-basic,.pagination .next,.pagination .page-number,.pagination .prev,.pagination .space{margin:0 5px}}.pagination .next,.pagination .page-number,.pagination .prev{border-bottom:0;border-top:1px solid #eee;transition-property:border-color;transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-top-color:#222}.pagination .space{padding:0;margin:0}.pagination .prev{margin-left:0}.pagination .next{margin-right:0}.pagination .page-number.current{color:#fff;background:#ccc;border-top-color:#ccc}@media (max-width:767px){.pagination{border-top:none}.pagination .next,.pagination .page-number,.pagination .prev{margin-bottom:10px;border-top:0;border-bottom:1px solid #eee;padding:0 10px}.pagination .next:hover,.pagination .page-number:hover,.pagination .prev:hover{border-bottom-color:#222}}.comments{margin:60px 20px 0}.tag-cloud{text-align:center}.tag-cloud a{display:inline-block;margin:10px}.back-to-top{box-sizing:border-box;position:fixed;bottom:-100px;right:30px;z-index:1050;padding:0 6px;width:24px;background:#222;font-size:12px;opacity:.6;color:#fff;cursor:pointer;text-align:center;-webkit-transform:translateZ(0);transition-property:bottom;transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s}@media (min-width:768px) and (max-width:991px){.back-to-top{display:none!important}}@media (max-width:767px){.back-to-top{display:none!important}}.back-to-top.back-to-top-on{bottom:30px}.header{background:0 0}.header-inner{position:relative}.headband{height:3px;background:#222}.site-meta{margin:0;text-align:center}@media (max-width:767px){.site-meta{text-align:center}}.brand{position:relative;display:inline-block;padding:0 40px;color:#fff;background:#222;border-bottom:none}.brand:hover{color:#fff}.logo{display:inline-block;margin-right:5px;line-height:36px;vertical-align:top}.site-title{display:inline-block;vertical-align:top;line-height:36px;font-size:24px;font-weight:400;font-family:'Lobster Two',Monda,"PingFang SC","Microsoft YaHei",sans-serif}.site-subtitle{margin-top:10px;font-size:13px;color:#ddd}.use-motion .brand{opacity:0}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:0;position:relative;top:-10px}.site-nav-toggle{display:none;position:absolute;top:10px;left:10px}@media (max-width:767px){.site-nav-toggle{display:block}}.site-nav-toggle button{margin-top:2px;padding:9px 10px;background:0 0;border:none}@media (max-width:767px){.site-nav{display:none;margin:0 -10px;padding:0 10px;clear:both;border-top:1px solid #ddd}}@media (min-width:768px) and (max-width:991px){.site-nav{display:block!important}}@media (min-width:992px){.site-nav{display:block!important}}.menu{margin-top:20px;padding-left:0;text-align:center}.menu .menu-item{display:inline-block;margin:0 10px;list-style:none}@media screen and (max-width:767px){.menu .menu-item{margin-top:10px}}.menu .menu-item a{display:block;font-size:13px;line-height:inherit;border-bottom:1px solid transparent;transition-property:border-color;transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s}.menu .menu-item a:hover,.menu-item-active a{border-bottom-color:#222}.menu .menu-item .fa{margin-right:5px}.use-motion .menu-item{opacity:0}.post-body{font-family:Monda,"PingFang SC","Microsoft YaHei",sans-serif}@media (max-width:767px){.post-body{word-break:break-word}}.post-body .fancybox img{display:block!important;margin:0 auto;cursor:pointer;cursor:zoom-in;cursor:-webkit-zoom-in}.post-body .figure .caption,.post-body .image-caption{margin:-20px auto 15px;text-align:center;font-size:14px;color:#999;font-weight:700;line-height:1}.post-sticky-flag{display:inline-block;font-size:16px;-ms-transform:rotate(30deg);-webkit-transform:rotate(30deg);-moz-transform:rotate(30deg);-ms-transform:rotate(30deg);-o-transform:rotate(30deg);transform:rotate(30deg)}.use-motion .comments,.use-motion .pagination,.use-motion .post-block{opacity:0}.use-motion .post-header{opacity:0}.use-motion .post-body{opacity:0}.use-motion .collection-title{opacity:0}.posts-expand{padding-top:40px}@media (max-width:767px){.posts-expand{margin:0 20px}.post-body pre .gutter pre{padding-right:10px}.post-body .highlight{margin-left:0;margin-right:0;padding:0}.post-body .highlight .gutter pre{padding-right:10px}}@media (min-width:992px){.posts-expand .post-body{text-align:justify}}.posts-expand .post-body h2,.posts-expand .post-body h3,.posts-expand .post-body h4,.posts-expand .post-body h5,.posts-expand .post-body h6{padding-top:10px}.posts-expand .post-body h2 .header-anchor,.posts-expand .post-body h3 .header-anchor,.posts-expand .post-body h4 .header-anchor,.posts-expand .post-body h5 .header-anchor,.posts-expand .post-body h6 .header-anchor{float:right;margin-left:10px;color:#ccc;border-bottom-style:none;visibility:hidden}.posts-expand .post-body h2 .header-anchor:hover,.posts-expand .post-body h3 .header-anchor:hover,.posts-expand .post-body h4 .header-anchor:hover,.posts-expand .post-body h5 .header-anchor:hover,.posts-expand .post-body h6 .header-anchor:hover{color:inherit}.posts-expand .post-body h2:hover .header-anchor,.posts-expand .post-body h3:hover .header-anchor,.posts-expand .post-body h4:hover .header-anchor,.posts-expand .post-body h5:hover .header-anchor,.posts-expand .post-body h6:hover .header-anchor{visibility:visible}.posts-expand .post-body ul li{list-style:circle}.posts-expand .post-body img{box-sizing:border-box;margin:auto;padding:3px;border:1px solid #ddd}.posts-expand .post-body .fancybox img{margin:0 auto 25px}@media (max-width:767px){.posts-collapse{margin:0 20px}.posts-collapse .post-meta,.posts-collapse .post-title{display:block;width:auto;text-align:left}}.posts-collapse{position:relative;z-index:1010;margin-left:55px}.posts-collapse::after{content:" ";position:absolute;top:20px;left:0;margin-left:-2px;width:4px;height:100%;background:#f5f5f5;z-index:-1}@media (max-width:767px){.posts-collapse{margin:0 20px}}.posts-collapse .collection-title{position:relative;margin:60px 0}.posts-collapse .collection-title h1,.posts-collapse .collection-title h2{margin-left:20px}.posts-collapse .collection-title small{color:#bbb;margin-left:5px}.posts-collapse .collection-title::before{content:" ";position:absolute;left:0;top:50%;margin-left:-4px;margin-top:-4px;width:8px;height:8px;background:#bbb;border-radius:50%}.posts-collapse .post{margin:30px 0}.posts-collapse .post-header{position:relative;transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s;transition-property:border;border-bottom:1px dashed #ccc}.posts-collapse .post-header::before{content:" ";position:absolute;left:0;top:12px;width:6px;height:6px;margin-left:-4px;background:#bbb;border-radius:50%;border:1px solid #fff;transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s;transition-property:background}.posts-collapse .post-header:hover{border-bottom-color:#666}.posts-collapse .post-header:hover::before{background:#222}.posts-collapse .post-meta{position:absolute;font-size:12px;left:20px;top:5px}.posts-collapse .post-comments-count{display:none}.posts-collapse .post-title{margin-left:60px;font-size:16px;font-weight:400;line-height:inherit}.posts-collapse .post-title::after{margin-left:3px;opacity:.6}.posts-collapse .post-title a{color:#666;border-bottom:none}.page-home .post-type-quote .post-header,.page-home .post-type-quote .post-tags,.page-post-detail .post-type-quote .post-header,.page-post-detail .post-type-quote .post-tags{display:none}.posts-expand .post-title{text-align:center;word-break:break-word;font-weight:400}.posts-expand .post-title-link{display:inline-block;position:relative;color:#555;border-bottom:none;line-height:1.2;vertical-align:top}.posts-expand .post-title-link::before{content:"";position:absolute;width:100%;height:2px;bottom:0;left:0;background-color:#000;visibility:hidden;-webkit-transform:scaleX(0);-moz-transform:scaleX(0);-ms-transform:scaleX(0);-o-transform:scaleX(0);transform:scaleX(0);transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s}.posts-expand .post-title-link:hover::before{visibility:visible;-webkit-transform:scaleX(1);-moz-transform:scaleX(1);-ms-transform:scaleX(1);-o-transform:scaleX(1);transform:scaleX(1)}.posts-expand .post-title-link .fa{font-size:16px}.posts-expand .post-meta{margin:3px 0 60px 0;color:#999;font-family:Monda,"PingFang SC","Microsoft YaHei",sans-serif;font-size:12px;text-align:center}.posts-expand .post-meta .post-category-list{display:inline-block;margin:0;padding:3px}.posts-expand .post-meta .post-category-list-link{color:#999}.posts-expand .post-meta .post-description{font-size:14px;margin-top:2px}.post-meta-divider{margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (min-width:768px) and (max-width:991px){.post-meta-item-icon{display:inline-block}}@media (max-width:767px){.post-meta-item-icon{display:inline-block}}@media (min-width:768px) and (max-width:991px){.post-meta-item-text{display:none}}@media (max-width:767px){.post-meta-item-text{display:none}}@media (max-width:767px){.posts-expand .post-comments-count{display:none}}.post-button{margin-top:40px}.posts-expand .post-tags{margin-top:40px;text-align:center}.posts-expand .post-tags a{display:inline-block;margin-right:10px;font-size:13px}.post-nav{display:table;margin-top:15px;width:100%;border-top:1px solid #eee}.post-nav-divider{display:table-cell;width:10%}.post-nav-item{display:table-cell;padding:10px 0 0 0;width:45%;vertical-align:top}.post-nav-item a{position:relative;display:block;line-height:25px;font-size:14px;color:#555;border-bottom:none}.post-nav-item a:hover{color:#222;border-bottom:none}.post-nav-item a:active{top:2px}.post-nav-item .fa{position:absolute;top:8px;left:0;font-size:12px}.post-nav-next a{padding-left:15px}.post-nav-prev{text-align:right}.post-nav-prev a{padding-right:15px}.post-nav-prev .fa{right:0;left:auto}.posts-expand .post-eof{display:block;margin:80px auto 60px;width:8%;height:1px;background:#ccc;text-align:center}.post:last-child .post-eof.post-eof.post-eof{display:none}.post-gallery{display:table;table-layout:fixed;width:100%;border-collapse:separate}.post-gallery-row{display:table-row}.post-gallery .post-gallery-img{display:table-cell;text-align:center;vertical-align:middle;border:none}.post-gallery .post-gallery-img img{max-width:100%;max-height:100%;border:none}.fancybox-close,.fancybox-close:hover{border:none}#rewardButton{cursor:pointer;border:0;outline:0;border-radius:5px;padding:0;margin:0;letter-spacing:normal;text-transform:none;text-indent:0;text-shadow:none}#rewardButton span{display:inline-block;width:80px;height:35px;border-radius:5px;color:#fff;font-weight:400;font-style:normal;font-variant:normal;font-stretch:normal;font-size:18px;font-family:"Microsoft Yahei";background:#f44336}#rewardButton span:hover{background:#f7877f}#QR{padding-top:20px}#QR a{border:0}#QR img{width:180px;max-width:100%;display:inline-block;margin:.8em 2em 0 2em}#wechat:hover p{animation:roll .1s infinite linear;-webkit-animation:roll .1s infinite linear;-moz-animation:roll .1s infinite linear}#alipay:hover p{animation:roll .1s infinite linear;-webkit-animation:roll .1s infinite linear;-moz-animation:roll .1s infinite linear}#bitcoin:hover p{animation:roll .1s infinite linear;-webkit-animation:roll .1s infinite linear;-moz-animation:roll .1s infinite linear}@-moz-keyframes roll{from{-webkit-transform:rotateZ(30deg);-moz-transform:rotateZ(30deg);-ms-transform:rotateZ(30deg);-o-transform:rotateZ(30deg);transform:rotateZ(30deg)}to{-webkit-transform:rotateZ(-30deg);-moz-transform:rotateZ(-30deg);-ms-transform:rotateZ(-30deg);-o-transform:rotateZ(-30deg);transform:rotateZ(-30deg)}}@-webkit-keyframes roll{from{-webkit-transform:rotateZ(30deg);-moz-transform:rotateZ(30deg);-ms-transform:rotateZ(30deg);-o-transform:rotateZ(30deg);transform:rotateZ(30deg)}to{-webkit-transform:rotateZ(-30deg);-moz-transform:rotateZ(-30deg);-ms-transform:rotateZ(-30deg);-o-transform:rotateZ(-30deg);transform:rotateZ(-30deg)}}@-o-keyframes roll{from{-webkit-transform:rotateZ(30deg);-moz-transform:rotateZ(30deg);-ms-transform:rotateZ(30deg);-o-transform:rotateZ(30deg);transform:rotateZ(30deg)}to{-webkit-transform:rotateZ(-30deg);-moz-transform:rotateZ(-30deg);-ms-transform:rotateZ(-30deg);-o-transform:rotateZ(-30deg);transform:rotateZ(-30deg)}}@keyframes roll{from{-webkit-transform:rotateZ(30deg);-moz-transform:rotateZ(30deg);-ms-transform:rotateZ(30deg);-o-transform:rotateZ(30deg);transform:rotateZ(30deg)}to{-webkit-transform:rotateZ(-30deg);-moz-transform:rotateZ(-30deg);-ms-transform:rotateZ(-30deg);-o-transform:rotateZ(-30deg);transform:rotateZ(-30deg)}}.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ol,.rtl.post-body p,.rtl.post-body ul{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.sidebar{position:fixed;right:0;top:0;bottom:0;width:0;z-index:1040;box-shadow:inset 0 2px 6px #000;background:#222;-webkit-transform:translateZ(0)}.sidebar a{color:#999;border-bottom-color:#555}.sidebar a:hover{color:#eee}@media (min-width:768px) and (max-width:991px){.sidebar{display:none!important}}@media (max-width:767px){.sidebar{display:none!important}}.sidebar-inner{position:relative;padding:20px 10px;color:#999;text-align:center}.site-overview-wrap{overflow:hidden}.site-overview{overflow-y:auto;overflow-x:hidden}.sidebar-toggle{position:fixed;right:30px;bottom:45px;width:14px;height:14px;padding:5px;background:#222;line-height:0;z-index:1050;cursor:pointer;-webkit-transform:translateZ(0)}@media (min-width:768px) and (max-width:991px){.sidebar-toggle{display:none!important}}@media (max-width:767px){.sidebar-toggle{display:none!important}}.sidebar-toggle-line{position:relative;display:inline-block;vertical-align:top;height:2px;width:100%;background:#fff;margin-top:3px}.sidebar-toggle-line:first-child{margin-top:0}.site-author-image{display:block;margin:0 auto;padding:2px;max-width:120px;height:auto;border:1px solid #eee}.site-author-name{margin:0;text-align:center;color:#222;font-weight:600}.site-description{margin-top:0;text-align:center;font-size:13px;color:#999}.site-state{overflow:hidden;line-height:1.4;white-space:nowrap;text-align:center}.site-state-item{display:inline-block;padding:0 15px;border-left:1px solid #eee}.site-state-item:first-child{border-left:none}.site-state-item a{border-bottom:none}.site-state-item-count{display:block;text-align:center;color:inherit;font-weight:600;font-size:16px}.site-state-item-name{font-size:13px;color:#999}.feed-link{margin-top:20px}.feed-link a{display:inline-block;padding:0 15px;color:#fc6423;border:1px solid #fc6423;border-radius:4px}.feed-link a i{color:#fc6423;font-size:14px}.feed-link a:hover{color:#fff;background:#fc6423}.feed-link a:hover i{color:#fff}.links-of-author{margin-top:20px}.links-of-author a{display:inline-block;vertical-align:middle;margin-right:10px;margin-bottom:10px;border-bottom-color:#555;font-size:13px}.links-of-author a:before{display:inline-block;vertical-align:middle;margin-right:3px;content:" ";width:4px;height:4px;border-radius:50%;background:#feb17f}.links-of-blogroll{font-size:13px}.links-of-blogroll-title{margin-top:20px;font-size:14px;font-weight:600}.links-of-blogroll-list{margin:0;padding:0;list-style:none}.links-of-blogroll-item{padding:2px 10px}.links-of-blogroll-item a{max-width:280px;box-sizing:border-box;display:inline-block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.sidebar-nav{margin:0 0 20px;padding-left:0}.sidebar-nav li{display:inline-block;cursor:pointer;border-bottom:1px solid transparent;font-size:14px;color:#555}.sidebar-nav li:hover{color:#fc6423}.page-post-detail .sidebar-nav-toc{padding:0 5px}.page-post-detail .sidebar-nav-overview{margin-left:10px}.sidebar-nav .sidebar-nav-active{color:#fc6423;border-bottom-color:#fc6423}.sidebar-nav .sidebar-nav-active:hover{color:#fc6423}.sidebar-panel{display:none}.sidebar-panel-active{display:block}.post-toc-empty{font-size:14px;color:#666}.post-toc-wrap{overflow:hidden}.post-toc{overflow:auto}.post-toc ol{margin:0;padding:0 2px 5px 10px;text-align:left;list-style:none;font-size:14px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s;transition-property:all;color:#666;border-bottom-color:#ccc}.post-toc ol a:hover{color:#000;border-bottom-color:#000}.post-toc .nav-item{overflow:hidden;text-overflow:ellipsis;text-align:justify;white-space:nowrap;line-height:1.8}.post-toc .nav .nav-child{display:none}.post-toc .nav .active>.nav-child{display:block}.post-toc .nav .active-current>.nav-child{display:block}.post-toc .nav .active-current>.nav-child>.nav-item{display:block}.post-toc .nav .active>a{color:#fc6423;border-bottom-color:#fc6423}.post-toc .nav .active-current>a{color:#fc6423}.post-toc .nav .active-current>a:hover{color:#fc6423}.footer{font-size:14px;color:#999}.footer img{border:none}.footer-inner{text-align:center}.with-love{display:inline-block;margin:0 5px}.powered-by,.theme-info{display:inline-block}.cc-license{margin-top:10px;text-align:center}.cc-license .cc-opacity{opacity:.7;border-bottom:none}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.theme-next #ds-thread #ds-reset{color:#555}.theme-next #ds-thread #ds-reset .ds-replybox{margin-bottom:30px}.theme-next #ds-reset .ds-avatar img,.theme-next #ds-thread #ds-reset .ds-replybox .ds-avatar{box-shadow:none}.theme-next #ds-thread #ds-reset .ds-textarea-wrapper{border-color:#c7d4e1;background:0 0;border-top-right-radius:3px;border-top-left-radius:3px}.theme-next #ds-thread #ds-reset .ds-textarea-wrapper textarea{height:60px}.theme-next #ds-reset .ds-rounded-top{border-radius:0}.theme-next #ds-thread #ds-reset .ds-post-toolbar{box-sizing:border-box;border:1px solid #c7d4e1;background:#f6f8fa}.theme-next #ds-thread #ds-reset .ds-post-options{height:40px;border:none;background:0 0}.theme-next #ds-thread #ds-reset .ds-toolbar-buttons{top:11px}.theme-next #ds-thread #ds-reset .ds-sync{top:5px}.theme-next #ds-thread #ds-reset .ds-post-button{top:4px;right:5px;width:90px;height:30px;border:1px solid #c5ced7;border-radius:3px;background-image:linear-gradient(#fbfbfc,#f5f7f9);color:#60676d}.theme-next #ds-thread #ds-reset .ds-post-button:hover{background-position:0 -30px;color:#60676d}.theme-next #ds-thread #ds-reset .ds-comments-info{padding:10px 0}.theme-next #ds-thread #ds-reset .ds-sort{display:none}.theme-next #ds-thread #ds-reset li.ds-tab a.ds-current{border:none;background:#f6f8fa;color:#60676d}.theme-next #ds-thread #ds-reset li.ds-tab a.ds-current:hover{background-color:#e9f0f7;color:#60676d}.theme-next #ds-thread #ds-reset li.ds-tab a{border-radius:2px;padding:5px}.theme-next #ds-thread #ds-reset .ds-login-buttons p{color:#999;line-height:36px}.theme-next #ds-thread #ds-reset .ds-login-buttons .ds-service-list li{height:28px}.theme-next #ds-thread #ds-reset .ds-service-list a{background:0 0;padding:5px;border:1px solid;border-radius:3px;text-align:center}.theme-next #ds-thread #ds-reset .ds-service-list a:hover{color:#fff;background:#666}.theme-next #ds-thread #ds-reset .ds-service-list .ds-weibo{color:#fc9b00;border-color:#fc9b00}.theme-next #ds-thread #ds-reset .ds-service-list .ds-weibo:hover{background:#fc9b00}.theme-next #ds-thread #ds-reset .ds-service-list .ds-qq{color:#60a3ec;border-color:#60a3ec}.theme-next #ds-thread #ds-reset .ds-service-list .ds-qq:hover{background:#60a3ec}.theme-next #ds-thread #ds-reset .ds-service-list .ds-renren{color:#2e7ac4;border-color:#2e7ac4}.theme-next #ds-thread #ds-reset .ds-service-list .ds-renren:hover{background:#2e7ac4}.theme-next #ds-thread #ds-reset .ds-service-list .ds-douban{color:#37994c;border-color:#37994c}.theme-next #ds-thread #ds-reset .ds-service-list .ds-douban:hover{background:#37994c}.theme-next #ds-thread #ds-reset .ds-service-list .ds-kaixin{color:#fef20d;border-color:#fef20d}.theme-next #ds-thread #ds-reset .ds-service-list .ds-kaixin:hover{background:#fef20d}.theme-next #ds-thread #ds-reset .ds-service-list .ds-netease{color:red;border-color:red}.theme-next #ds-thread #ds-reset .ds-service-list .ds-netease:hover{background:red}.theme-next #ds-thread #ds-reset .ds-service-list .ds-sohu{color:#ffcb05;border-color:#ffcb05}.theme-next #ds-thread #ds-reset .ds-service-list .ds-sohu:hover{background:#ffcb05}.theme-next #ds-thread #ds-reset .ds-service-list .ds-baidu{color:#2831e0;border-color:#2831e0}.theme-next #ds-thread #ds-reset .ds-service-list .ds-baidu:hover{background:#2831e0}.theme-next #ds-thread #ds-reset .ds-service-list .ds-google{color:#166bec;border-color:#166bec}.theme-next #ds-thread #ds-reset .ds-service-list .ds-google:hover{background:#166bec}.theme-next #ds-thread #ds-reset .ds-service-list .ds-weixin{color:#00ce0d;border-color:#00ce0d}.theme-next #ds-thread #ds-reset .ds-service-list .ds-weixin:hover{background:#00ce0d}.theme-next #ds-thread #ds-reset .ds-service-list .ds-more-services{border:none}.theme-next #ds-thread #ds-reset .ds-service-list .ds-more-services:hover{background:0 0}.theme-next #ds-reset .duoshuo-ua-admin{display:inline-block;color:red}.theme-next #ds-reset .duoshuo-ua-browser,.theme-next #ds-reset .duoshuo-ua-platform{color:#ccc}.theme-next #ds-reset .duoshuo-ua-browser .fa,.theme-next #ds-reset .duoshuo-ua-platform .fa{display:inline-block;margin-right:3px}.theme-next #ds-reset .duoshuo-ua-separator{display:inline-block;margin-left:5px}.theme-next .this_ua{background-color:#ccc!important;border-radius:4px;padding:0 5px!important;margin:1px 1px!important;border:1px solid #bbb!important;color:#fff;display:inline-block!important}.theme-next .this_ua.admin{background-color:#d9534f!important;border-color:#d9534f!important}.theme-next .this_ua.platform.Mac,.theme-next .this_ua.platform.Windows,.theme-next .this_ua.platform.iOS{background-color:#39b3d7!important;border-color:#46b8da!important}.theme-next .this_ua.platform.Linux{background-color:#3a3a3a!important;border-color:#1f1f1f!important}.theme-next .this_ua.platform.Android{background-color:#00c47d!important;border-color:#01b171!important}.theme-next .this_ua.browser.Chrome,.theme-next .this_ua.browser.Mobile{background-color:#5cb85c!important;border-color:#4cae4c!important}.theme-next .this_ua.browser.Firefox{background-color:#f0ad4e!important;border-color:#eea236!important}.theme-next .this_ua.browser.IE,.theme-next .this_ua.browser.Maxthon{background-color:#428bca!important;border-color:#357ebd!important}.theme-next .this_ua.browser.Opera,.theme-next .this_ua.browser.UCBrowser,.theme-next .this_ua.browser.baidu{background-color:#d9534f!important;border-color:#d43f3a!important}.theme-next .this_ua.browser.Android,.theme-next .this_ua.browser.QQBrowser{background-color:#78ace9!important;border-color:#4cae4c!important}.post-spread{margin-top:20px;text-align:center}.jiathis_style{display:inline-block}.jiathis_style a{border:none}.fa{font-family:FontAwesome!important}.post-spread{margin-top:20px;text-align:center}.bdshare-slide-button-box a{border:none}.bdsharebuttonbox{display:inline-block}.bdsharebuttonbox a{border:none}.local-search-pop-overlay{position:fixed;width:100%;height:100%;top:0;left:0;z-index:2080;background-color:rgba(0,0,0,.3)}.local-search-popup{display:none;position:fixed;top:10%;left:50%;margin-left:-350px;width:700px;height:80%;padding:0;background:#fff;color:#333;z-index:9999;border-radius:5px}@media (max-width:767px){.local-search-popup{padding:0;top:0;left:0;margin:0;width:100%;height:100%;border-radius:0}}.local-search-popup ul.search-result-list{padding:0;margin:0 5px}.local-search-popup p.search-result{border-bottom:1px dashed #ccc;padding:5px 0}.local-search-popup a.search-result-title{font-weight:700;font-size:16px}.local-search-popup .search-keyword{border-bottom:1px dashed red;font-weight:700;color:red}.local-search-popup .local-search-header{padding:5px;height:36px;background:#f5f5f5;border-top-left-radius:5px;border-top-right-radius:5px}.local-search-popup #local-search-result{overflow:auto;position:relative;padding:5px 25px;height:calc(100% - 55px)}.local-search-popup .local-search-input-wrapper{display:inline-block;width:calc(100% - 90px);height:36px;line-height:36px;padding:0 5px}.local-search-popup .local-search-input-wrapper input{padding:8px 0;height:20px;display:block;width:100%;outline:0;border:none;background:0 0;vertical-align:middle}.local-search-popup .popup-btn-close,.local-search-popup .search-icon{display:inline-block;font-size:18px;color:#999;height:36px;width:18px;padding-left:10px;padding-right:10px}.local-search-popup .search-icon{float:left}.local-search-popup .popup-btn-close{border-left:1px solid #eee;float:right;cursor:pointer}.local-search-popup #no-result{position:absolute;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:#ccc}@media (min-width:768px) and (max-width:991px){.busuanzi-count{width:auto}}@media (max-width:767px){.busuanzi-count{width:auto}}.page-pv,.site-pv,.site-uv{display:inline-block}.page-pv .busuanzi-value,.site-pv .busuanzi-value,.site-uv .busuanzi-value{margin:0 5px}.site-uv{margin-right:10px}.site-uv::after{content:"|";padding-left:10px}#needsharebutton-postbottom{position:relative;cursor:pointer;height:26px}#needsharebutton-postbottom .btn{display:initial;padding:1px 4px;border:1px solid #555;border-radius:3px}#needsharebutton-float{position:fixed;bottom:38px;left:-8px;z-index:9999;cursor:pointer}#needsharebutton-float .btn{padding:0 10px 0 14px;border:1px solid #555;border-radius:4px}.page-archive .archive-page-counter{position:relative;top:3px;left:20px}@media (max-width:767px){.page-archive .archive-page-counter{top:5px}}.page-archive .posts-collapse .archive-move-on{position:absolute;top:11px;left:0;margin-left:-6px;width:10px;height:10px;opacity:.5;background:#555;border:1px solid #fff;border-radius:50%}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{margin:0;padding:0;list-style:none}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{color:#bbb}.category-all-page .category-list-count:before{display:inline;content:" ("}.category-all-page .category-list-count:after{display:inline;content:") "}.category-all-page .category-list-child{padding-left:10px}#schedule ul#event-list{padding-left:30px}#schedule ul#event-list hr{margin:20px 0 45px 0!important;background:#222}#schedule ul#event-list hr:after{display:inline-block;content:'NOW';background:#222;color:#fff;font-weight:700;text-align:right;padding:0 5px}#schedule ul#event-list li.event{margin:20px 0;background:#f9f9f9;padding-left:10px;min-height:40px}#schedule ul#event-list li.event h2.event-summary{margin:0;padding-bottom:3px}#schedule ul#event-list li.event h2.event-summary:before{display:inline-block;font-family:FontAwesome;font-size:8px;content:'\f111';vertical-align:middle;margin-right:25px;color:#bbb}#schedule ul#event-list li.event span.event-relative-time{display:inline-block;font-size:12px;font-weight:400;padding-left:12px;color:#bbb}#schedule ul#event-list li.event span.event-details{display:block;color:#bbb;margin-left:56px;padding-top:3px;padding-bottom:6px;text-indent:-24px;line-height:18px}#schedule ul#event-list li.event span.event-details:before{text-indent:0;display:inline-block;width:14px;font-family:FontAwesome;text-align:center;margin-right:9px;color:#bbb}#schedule ul#event-list li.event span.event-details.event-location:before{content:'\f041'}#schedule ul#event-list li.event span.event-details.event-duration:before{content:'\f017'}#schedule ul#event-list li.event-past{background:#fcfcfc}#schedule ul#event-list li.event-past>*{opacity:.6}#schedule ul#event-list li.event-past h2.event-summary{color:#bbb}#schedule ul#event-list li.event-past h2.event-summary:before{color:#dfdfdf}#schedule ul#event-list li.event-now{background:#222;color:#fff;padding:15px 0 15px 10px}#schedule ul#event-list li.event-now h2.event-summary:before{-webkit-transform:scale(1.2);-moz-transform:scale(1.2);-ms-transform:scale(1.2);-o-transform:scale(1.2);transform:scale(1.2);color:#fff;animation:dot-flash 1s alternate infinite ease-in-out}#schedule ul#event-list li.event-now *{color:#fff!important}@-moz-keyframes dot-flash{from{opacity:1;-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}to{opacity:0;-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);-o-transform:scale(1);transform:scale(1)}}@-webkit-keyframes dot-flash{from{opacity:1;-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}to{opacity:0;-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);-o-transform:scale(1);transform:scale(1)}}@-o-keyframes dot-flash{from{opacity:1;-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}to{opacity:0;-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);-o-transform:scale(1);transform:scale(1)}}@keyframes dot-flash{from{opacity:1;-webkit-transform:scale(1.1);-moz-transform:scale(1.1);-ms-transform:scale(1.1);-o-transform:scale(1.1);transform:scale(1.1)}to{opacity:0;-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);-o-transform:scale(1);transform:scale(1)}}.page-post-detail .sidebar-toggle-line{background:#fc6423}.page-post-detail .comments{overflow:hidden}.header{position:relative;margin:0 auto;width:960px}@media (min-width:768px) and (max-width:991px){.header{width:auto}}@media (max-width:767px){.header{width:auto}}.header-inner{position:absolute;top:0;overflow:hidden;padding:0;width:240px;background:#fff;box-shadow:initial;border-radius:initial}@media (min-width:1600px){.container .header-inner{width:240px}}@media (min-width:768px) and (max-width:991px){.header-inner{position:relative;width:auto;border-radius:initial}}@media (max-width:767px){.header-inner{position:relative;width:auto;border-radius:initial}}.main:after,.main:before{content:" ";display:table}.main:after{clear:both}@media (min-width:768px) and (max-width:991px){.main{padding-bottom:100px}}@media (max-width:767px){.main{padding-bottom:100px}}.container .main-inner{width:960px}@media (min-width:768px) and (max-width:991px){.container .main-inner{width:auto}}@media (max-width:767px){.container .main-inner{width:auto}}.content-wrap{float:right;box-sizing:border-box;padding:40px;width:700px;background:#fff;min-height:700px;box-shadow:initial;border-radius:initial}@media (min-width:768px) and (max-width:991px){.content-wrap{width:100%;padding:20px;border-radius:initial}}@media (max-width:767px){.content-wrap{width:100%;padding:20px;min-height:auto;border-radius:initial}}.sidebar{position:static;float:left;margin-top:300px;width:240px;background:#f5f7f9;box-shadow:none}@media (min-width:768px) and (max-width:991px){.sidebar{display:none}}@media (max-width:767px){.sidebar{display:none}}.sidebar-toggle{display:none}.footer-inner{width:960px;padding-left:260px}@media (min-width:768px) and (max-width:991px){.footer-inner{width:auto;padding-left:0!important;padding-right:0!important}}@media (max-width:767px){.footer-inner{width:auto;padding-left:0!important;padding-right:0!important}}.sidebar-position-right .header-inner{right:0}.sidebar-position-right .content-wrap{float:left}.sidebar-position-right .sidebar{float:right}.sidebar-position-right .footer-inner{padding-left:0;padding-right:260px}.site-brand-wrapper{position:relative}.site-meta{padding:20px 0;color:#fff;background:#222}@media (min-width:768px) and (max-width:991px){.site-meta{box-shadow:0 0 16px rgba(0,0,0,.5)}}@media (max-width:767px){.site-meta{box-shadow:0 0 16px rgba(0,0,0,.5)}}.brand{padding:0;background:0 0}.brand:hover{color:#fff}.site-subtitle{margin:10px 10px 0;font-weight:initial}.site-search form{display:none}.site-nav{border-top:none}@media (min-width:768px) and (max-width:991px){.site-nav{display:none!important}}@media (min-width:768px) and (max-width:991px){.site-nav-on{display:block!important}}.menu .menu-item{display:block;margin:0}.menu .menu-item a{position:relative;box-sizing:border-box;padding:5px 20px;text-align:left;line-height:inherit;transition-property:background-color;transition-duration:.2s;transition-timing-function:ease-in-out;transition-delay:0s}.menu .menu-item a:hover,.menu-item-active a{background:#f9f9f9;border-bottom-color:#fff}.menu .menu-item br{display:none}.menu-item-active a:after{content:" ";position:absolute;top:50%;margin-top:-3px;right:15px;width:6px;height:6px;border-radius:50%;background-color:#bbb}.btn-bar{background-color:#fff}.site-nav-toggle{left:20px;top:50%;-webkit-transform:translateY(-50%);-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);-o-transform:translateY(-50%);transform:translateY(-50%)}@media (min-width:768px) and (max-width:991px){.site-nav-toggle{display:block}}.use-motion .sidebar .motion-element{opacity:1}.sidebar{margin-left:-100%;right:auto;bottom:auto;-webkit-transform:none}.sidebar-inner{box-sizing:border-box;width:240px;color:#555;background:#fff;box-shadow:initial;border-radius:initial;opacity:0}.sidebar-inner.affix{position:fixed;top:12px}.sidebar-inner.affix-bottom{position:absolute}.site-overview{text-align:left}.site-author:after,.site-author:before{content:" ";display:table}.site-author:after{clear:both}.sidebar a{color:#555}.sidebar a:hover{color:#222}.site-state-item{padding:0 10px}.links-of-author-item a:before{display:none}.links-of-author-item a{border-bottom:none;text-decoration:underline}.feed-link{border-top:1px dotted #ccc;border-bottom:1px dotted #ccc;text-align:center}.feed-link a{display:block;color:#fc6423;border:none}.feed-link a:hover{background:0 0;color:#e34603}.feed-link a:hover i{color:#e34603}.links-of-author{display:flex;flex-wrap:wrap;justify-content:center}.links-of-author-item{margin:5px 0 0;width:50%}.links-of-author-item a{max-width:216px;box-sizing:border-box;display:inline-block;margin-right:0;margin-bottom:0;padding:0 5px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.links-of-author-item a{display:block;text-decoration:none}.links-of-author-item a:hover{border-radius:4px;background:#eee}.links-of-author-item .fa{margin-right:2px;font-size:16px}.links-of-author-item .fa-globe{font-size:15px}.links-of-blogroll{text-align:center;margin-top:20px;padding:3px 0 0;border-top:1px dotted #ccc}.links-of-blogroll-title{margin-top:0}.links-of-blogroll-item{padding:0}.links-of-blogroll-inline:after,.links-of-blogroll-inline:before{content:" ";display:table}.links-of-blogroll-inline:after{clear:both}.links-of-blogroll-inline .links-of-blogroll-item{margin:5px 0 0;width:50%;display:inline-block;width:unset}.links-of-blogroll-inline .links-of-blogroll-item a{max-width:216px;box-sizing:border-box;display:inline-block;margin-right:0;margin-bottom:0;padding:0 5px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@media (max-width:767px){.post-body{text-align:justify}}</style><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;subset=latin,latin-ext"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.6.3/css/font-awesome.min.css"></noscript></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">大鹏的博客</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://zhangyapeng0222.github.io/person_blogs/2019/01/15/loader/"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="dapeng"><meta itemprop="description" content=""><meta itemprop="image" content="/uploads/avatar.jpg"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="大鹏的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">loader</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-15T11:34:48+08:00">2019-01-15 </time></span><span id="/2019/01/15/loader/" class="leancloud_visitors" data-flag-title="loader"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数:</span> <span class="leancloud-visitors-count"></span></span><div class="post-wordcount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">字数统计:</span> <span title="字数统计">5,889 </span><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 ≈</span> <span title="阅读时长">28</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="loader运行的总体流程-一个函数"><a href="#loader运行的总体流程-一个函数" class="headerlink" title="loader运行的总体流程(一个函数)"></a>loader运行的总体流程(一个函数)</h2><p><img src="http://b.zhangyapeng.club/loader-2019115113541.jpg" alt="loader-2019115113541"></p><h2 id="loader配置"><a href="#loader配置" class="headerlink" title="loader配置"></a>loader配置</h2><p><code>loader</code>是导出为一个<code>函数</code>的node模块。该函数在<code>loader</code>转换资源的时候调用。给定的函数将调用<code>loader API</code>(loaderContext)，并通过<code>this</code>上下文访问。</p><h3 id="匹配-test-单个-loader"><a href="#匹配-test-单个-loader" class="headerlink" title="匹配(test)单个 loader"></a>匹配(test)单个 loader</h3><p>匹配(test)单个 <code>loader</code>，你可以简单通过在 <strong>rule</strong> 对象设置 <code>path.resolve</code> 指向这个本地文件<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  test: <span class="regexp">/\.js$/</span></span><br><span class="line">  use: [</span><br><span class="line">    {</span><br><span class="line">      loader: path.resolve(<span class="string">'path/to/loader.js'</span>),</span><br><span class="line">      options: {<span class="comment">/* ... */</span>}</span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="匹配-test-多个-loaders"><a href="#匹配-test-多个-loaders" class="headerlink" title="匹配(test)多个 loaders"></a>匹配(test)多个 loaders</h3><p>你可以使用 <code>resolveLoader.modules</code> 配置，<code>webpack</code> 将会从这些目录中搜索这些 <code>loaders</code><br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resolveLoader: {</span><br><span class="line">   modules: [path.resolve(<span class="string">'node_modules'</span>), path.resolve(__dirname, <span class="string">'src'</span>, <span class="string">'loaders'</span>)]</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="npm-link"><a href="#npm-link" class="headerlink" title="npm link"></a>npm link</h3><ul><li>确保正在开发的本地<code>Npm</code> 模块（也就是正在开发的 Loader）的 <code>package.json</code> 已经正确配置好； 在本地 <code>Npm</code> 模块根目录下执行 <code>npm link</code>，把本地模块注册到全局；</li><li>在项目根目录下执行<code>npm link loader-name</code>，把第2步注册到全局的本地 <code>Npm</code> 模块链接到项目的 <code>node_moduels</code> 下，其中的 - <code>loader-name</code> 是指在第1步中的 <code>package.json</code> 文件中配置的模块名称。</li></ul><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm link</span><br></pre></td></tr></tbody></table></figure><h3 id="alias"><a href="#alias" class="headerlink" title="alias"></a>alias</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">resolveLoader: {</span><br><span class="line">        alias: {</span><br><span class="line">            <span class="string">"babel-loader"</span>: resolve(<span class="string">'./loaders/babel-loader.js'</span>),</span><br><span class="line">            <span class="string">"css-loader"</span>: resolve(<span class="string">'./loaders/css-loader.js'</span>),</span><br><span class="line">            <span class="string">"style-loader"</span>: resolve(<span class="string">'./loaders/style-loader.js'</span>),</span><br><span class="line">            <span class="string">"file-loader"</span>: resolve(<span class="string">'./loaders/file-loader.js'</span>),</span><br><span class="line">            <span class="string">"url-loader"</span>: resolve(<span class="string">'./loaders/url-loader.js'</span>)</span><br><span class="line">        }</span><br><span class="line">    },</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="loader用法"><a href="#loader用法" class="headerlink" title="loader用法"></a>loader用法</h2><h3 id="单个loader用法"><a href="#单个loader用法" class="headerlink" title="单个loader用法"></a>单个loader用法</h3><ul><li>当一个 <strong>loader</strong> 在资源中使用，这个 <strong>loader</strong> 只能传入一个参数 - 这个参数是一个包含<code>资源文件内容的字符串</code></li><li>同步 <strong>loader</strong> 可以简单的返回一个代表模块转化后的值。</li><li>在更复杂的情况下，<code>loader</code> 也可以通过使用 <code>this.callback(err, values...)</code>函数，返回任意数量的值。错误要么传递给这个<code>this.callback</code> 函数，要么扔进同步 <code>loader</code> 中。</li><li><code>loader</code>只能传入一个包含包含资源文件内容的字符串</li><li>同步 <code>loader</code>可以简单的返回一个代表模块转化后的值</li><li>loader 也可以通过使用 <code>this.callback(err, values...)</code> 函数，返回任意数量的值</li><li>loader 会返回<strong>一个或者两个值</strong>。第一个值的类型是 <code>JavaScript</code> 代码的<code>字符串</code>或者 <code>buffer</code>。第二个参数值是<code>SourceMap</code>，它是个 <code>JavaScript</code> 对象</li></ul><h3 id="多个loader"><a href="#多个loader" class="headerlink" title="多个loader"></a>多个loader</h3><p>当链式调用多个 <strong>loader</strong>的时候，请记住它们会以相反的顺序执行。取决于数组写法格式，从<code>右向左</code>或者从<code>下向上</code>执行。</p><ul><li>最后的 loader 最早调用，将会传入原始资源内容。</li><li>第一个 loader 最后调用，期望值是传出 <code>JavaScript</code> 和 <code>source map</code>（可选）。</li><li>中间的 loader 执行时，会传入前一个 <code>loader</code> 传出的结果。</li></ul><h3 id="单个loader用法-1"><a href="#单个loader用法-1" class="headerlink" title="单个loader用法"></a>单个loader用法</h3><ul><li>最后的 <code>loader</code> 最早调用，将会传入原始资源内容。</li><li>第一个 <code>loader</code> 最后调用，期望值是传出 <code>JavaScript</code> 和 <code>source map</code>（可选）。</li><li>中间的<code>loader</code> 执行时，会传入前一个 <code>loader</code> 传出的结果。</li></ul><hr><h2 id="用法准则"><a href="#用法准则" class="headerlink" title="用法准则"></a>用法准则</h2><h3 id="简单"><a href="#简单" class="headerlink" title="简单"></a>简单</h3><p><code>loaders</code> 应该只做单一任务。这不仅使每个 <code>loader</code> 易维护，也可以在更多场景链式调用。</p><h3 id="链式-Chaining"><a href="#链式-Chaining" class="headerlink" title="链式(Chaining)"></a>链式(Chaining)</h3><p>利用 <code>loader</code> 可以链式调用的优势。写五个简单的 <code>loader</code> 实现五项任务，而不是一个 <code>loader</code> 实现五项任务</p><h3 id="模块化-Modular"><a href="#模块化-Modular" class="headerlink" title="模块化(Modular)"></a>模块化(Modular)</h3><p>保证输出模块化。<code>loader</code> 生成的模块与普通模块遵循相同的设计原则。</p><h3 id="无状态-Stateless"><a href="#无状态-Stateless" class="headerlink" title="无状态(Stateless)"></a>无状态(Stateless)</h3><p>确保 <code>loader</code> 在不同模块转换之间不保存状态。每次运行都应该独立于其他编译模块以及相同模块之前的编译结果。</p><h3 id="loader-工具库-Loader-Utilities"><a href="#loader-工具库-Loader-Utilities" class="headerlink" title="loader 工具库(Loader Utilities)"></a>loader 工具库(Loader Utilities)</h3><p><a href="https://github.com/webpack/loader-utils" target="_blank" rel="noopener">loader-utils</a> 包。它提供了许多有用的工具，但最常用的一种工具是获取传递给 <code>loader</code> 的选项</p><p><a href="https://github.com/webpack-contrib/schema-utils" target="_blank" rel="noopener">schema-utils</a> 包配合 <code>loader-utils</code>，用于保证 <code>loader</code> 选项，进行与 <code>JSON Schema</code> 结构一致的校验</p><h3 id="loader-依赖-Loader-Dependencies"><a href="#loader-依赖-Loader-Dependencies" class="headerlink" title="loader 依赖(Loader Dependencies)"></a>loader 依赖(Loader Dependencies)</h3><p>如果一个 <code>loader</code> 使用外部资源（例如，从文件系统读取），必须声明它。这些信息用于使缓存 <code>loaders</code> 无效，以及在观察模式(watch mode)下重编译。</p><h3 id="模块依赖-Module-Dependencies"><a href="#模块依赖-Module-Dependencies" class="headerlink" title="模块依赖(Module Dependencies)"></a>模块依赖(Module Dependencies)</h3><p>根据模块类型，可能会有不同的模式指定依赖关系。例如在 <code>CSS</code> 中，使用 <code>@import</code> 和 <code>url(...)</code> 语句来声明依赖。这些依赖关系应该由模块系统解析。</p><h3 id="绝对路径-Absolute-Paths"><a href="#绝对路径-Absolute-Paths" class="headerlink" title="绝对路径(Absolute Paths)"></a>绝对路径(Absolute Paths)</h3><p>不要在模块代码中插入绝对路径，因为当项目根路径变化时，文件绝对路径也会变化。<code>loader-utils</code> 中的 <code>stringifyRequest</code> 方法，可以将绝对路径转化为相对路径。</p><h3 id="同等依赖-Peer-Dependencies"><a href="#同等依赖-Peer-Dependencies" class="headerlink" title="同等依赖(Peer Dependencies)"></a>同等依赖(Peer Dependencies)</h3><p>如果你的 <code>loader</code> 简单包裹另外一个包，你应该把这个包作为一个 <code>peerDependency</code> 引入。<br>这种方式允许应用程序开发者在必要情况下，在 <code>package.json</code> 中指定所需的确定版本。</p><hr><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><h3 id="缓存结果"><a href="#缓存结果" class="headerlink" title="缓存结果"></a>缓存结果</h3><p><code>webpack</code>充分地利用缓存来提高编译效率<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.cacheable();</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><p>当一个 <code>Loader</code> 无依赖，可异步的时候我想都应该让它不再阻塞地去异步<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 让 Loader 缓存</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> callback = <span class="keyword">this</span>.async();</span><br><span class="line">    <span class="comment">// 做异步的事</span></span><br><span class="line">    doSomeAsyncOperation(content, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>{</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">return</span> callback(err);</span><br><span class="line">        callback(<span class="literal">null</span>, result);</span><br><span class="line">    });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="raw-loader"><a href="#raw-loader" class="headerlink" title="raw loader"></a>raw loader</h3><p>默认的情况源文件是以 <code>UTF-8</code>字符串的形式传入给 <code>Loader</code>,设置<code>module.exports.raw = true</code>可使用 <code>buffer</code> 的形式进行处理<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.raw = <span class="literal">true</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="获得-Loader-的-options"><a href="#获得-Loader-的-options" class="headerlink" title="获得 Loader 的 options"></a>获得 Loader 的 options</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>{</span><br><span class="line">  <span class="comment">// 获取到用户给当前 Loader 传入的 options</span></span><br><span class="line">  <span class="keyword">const</span> options = loaderUtils.getOptions(<span class="keyword">this</span>);</span><br><span class="line">  <span class="keyword">return</span> source;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><h3 id="返回其它结果"><a href="#返回其它结果" class="headerlink" title="返回其它结果"></a>返回其它结果</h3><p><code>Loader</code>有些场景下还需要返回除了内容之外的东西<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>{</span><br><span class="line">  <span class="comment">// 通过 this.callback 告诉 Webpack 返回的结果</span></span><br><span class="line">  <span class="keyword">this</span>.callback(<span class="literal">null</span>, source, sourceMaps);</span><br><span class="line">  <span class="comment">// 当你使用 this.callback 返回内容时，该 Loader 必须返回 undefined，</span></span><br><span class="line">  <span class="comment">// 以让 Webpack 知道该 Loader 返回的结果在 this.callback 中，而不是 return 中 </span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><p>完整格式(<code>见NormalModule.js----&gt;runLoaders</code>)<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.callback(</span><br><span class="line">    <span class="comment">// 当无法转换原内容时，给 Webpack 返回一个 Error</span></span><br><span class="line">    err: <span class="built_in">Error</span> | <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">// 原内容转换后的内容</span></span><br><span class="line">    content: string | Buffer,</span><br><span class="line">    <span class="comment">// 用于把转换后的内容得出原内容的 Source Map，方便调试</span></span><br><span class="line">    sourceMap?: SourceMap,</span><br><span class="line">    <span class="comment">// 如果本次转换为原内容生成了 AST 语法树，可以把这个 AST 返回，</span></span><br><span class="line">    <span class="comment">// 以方便之后需要 AST 的 Loader 复用该 AST，以避免重复生成 AST，提升性能</span></span><br><span class="line">    abstractSyntaxTree?: AST</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="同步与异步"><a href="#同步与异步" class="headerlink" title="同步与异步"></a>同步与异步</h3><p><code>Loader</code> 有同步和异步之分，上面介绍的<code>Loader</code> 都是同步的 <code>Loader</code>，因为它们的转换流程都是同步的，转换完成后再返回结果。 但在有些场景下转换的步骤只能是异步完成的，例如你需要通过网络请求才能得出结果，如果采用同步的方式网络请求就会阻塞整个构建，导致构建非常缓慢。<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="comment">// 告诉 Webpack 本次转换是异步的，Loader 会在 callback 中回调结果</span></span><br><span class="line">    <span class="keyword">var</span> callback = <span class="keyword">this</span>.async();</span><br><span class="line">    someAsyncOperation(source, <span class="function"><span class="keyword">function</span>(<span class="params">err, result, sourceMaps, ast</span>) </span>{</span><br><span class="line">        <span class="comment">// 通过 callback 返回异步执行后的结果</span></span><br><span class="line">        callback(err, result, sourceMaps, ast);</span><br><span class="line">    });</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="处理二进制数据"><a href="#处理二进制数据" class="headerlink" title="处理二进制数据"></a>处理二进制数据</h3><p>在默认的情况下，<code>Webpack</code> 传给 <code>Loader</code> 的原内容都是 <code>UTF-8</code> 格式编码的字符串。 但有些场景下 <code>Loader</code> 不是处理文本文件，而是处理二进制文件，例如 <code>file-loader</code>，就需要 <code>Webpack</code> 给 <code>Loader</code> 传入二进制格式的数据。 为此，你需要这样编写 <code>Loader</code>：<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="comment">// 在 exports.raw === true 时，Webpack 传给 Loader 的 source 是 Buffer 类型的</span></span><br><span class="line">    source <span class="keyword">instanceof</span> Buffer === <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// Loader 返回的类型也可以是 Buffer 类型的</span></span><br><span class="line">    <span class="comment">// 在 exports.raw !== true 时，Loader 也可以返回 Buffer 类型的结果</span></span><br><span class="line">    <span class="keyword">return</span> source;</span><br><span class="line">};</span><br><span class="line"><span class="comment">// 通过 exports.raw 属性告诉 Webpack 该 Loader 是否需要二进制数据 </span></span><br><span class="line"><span class="built_in">module</span>.exports.raw = <span class="literal">true</span>;</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><p>在有些情况下，有些转换操作需要大量计算非常<code>耗时</code>，如果每次构建都重新执行重复的转换操作，构建将会变得非常缓慢。 为此，<code>Webpack</code>会<strong>默认缓存</strong>所有<code>Loader</code> 的处理结果，也就是说在需要被处理的文件或者其依赖的文件没有发生变化时， 是不会重新调用对应的 <code>Loader</code> 去执行转换操作的。<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>) </span>{</span><br><span class="line">  <span class="comment">// 关闭该 Loader 的缓存功能</span></span><br><span class="line">  <span class="keyword">this</span>.cacheable(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">return</span> source;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="其它-Loader-API"><a href="#其它-Loader-API" class="headerlink" title="其它 Loader API"></a>其它 Loader API</h3><ul><li><a href="https://webpack.docschina.org/api/loaders/#%E5%90%8C%E6%AD%A5-loader" target="_blank" rel="noopener">完整API</a></li></ul><table><thead><tr><th>方法名</th><th>含义</th></tr></thead><tbody><tr><td>this.context</td><td>当前处理文件的所在目录，假如当前 Loader 处理的文件是 /src/main.js，则 this.context 就等于 /src</td></tr><tr><td>this.resource</td><td>当前处理文件的完整请求路径，包括 querystring，例如 /src/main.js?name=1。</td></tr><tr><td>this.resourcePath</td><td>当前处理文件的路径，例如 /src/main.js</td></tr><tr><td>this.resourceQuery</td><td>当前处理文件的 querystring</td></tr><tr><td>this.target</td><td>等于 Webpack 配置中的 Target</td></tr><tr><td>this.loadModule</td><td>但 Loader 在处理一个文件时，如果依赖其它文件的处理结果才能得出当前文件的结果时,就可以通过 this.loadModule(request: string,</td><td>callback: function(err, source, sourceMap, module)) 去获得 request 对应文件的处理结果</td></tr><tr><td>this.resolve</td><td>像 require 语句一样获得指定文件的完整路径，使用方法为 resolve(context: string, request: string, callback: function(err, result: string))</td></tr><tr><td>this.addDependency</td><td>给当前处理文件添加其依赖的文件，以便再其依赖的文件发生变化时，会重新调用 Loader 处理该文件。使用方法为 addDependency(file: string)</td></tr><tr><td>this.addContextDependency</td><td>和 addDependency 类似，但 addContextDependency 是把整个目录加入到当前正在处理文件的依赖中。使用方法为 addContextDependency(directory: string)</td></tr><tr><td>this.clearDependencies</td><td>清除当前正在处理文件的所有依赖，使用方法为 clearDependencies()</td></tr><tr><td>this.emitFile</td><td>输出一个文件，使用方法为 emitFile(name: string, content: Buffer/string, sourceMap: {…})</td></tr><tr><td>loader-utils.stringifyRequest</td><td>Turns a request into a string that can be used inside require() or import while avoiding absolute paths. Use it instead of JSON.stringify(…) if you’re generating code inside a loader 把一个请求字符串转成一个字符串，以便能在require或者import中使用以避免绝对路径。如果你在一个loder中生成代码的话请使用这个而不要用JSON.stringify()</td></tr><tr><td>loader-utils.interpolateName</td><td>Interpolates a filename template using multiple placeholders and/or a regular expression. The template and regular expression are set as query params called name and regExp on the current loader’s context. 使用多个占位符或一个正则表达式转换一个文件名的模块。这个模板和正则表达式被设置为查询参数，在当前loader的上下文中被称为name或者regExp</td></tr></tbody></table><h2 id="loader实战"><a href="#loader实战" class="headerlink" title="loader实战"></a>loader实战</h2><hr><ul><li>loader-utils</li><li>schema-utils</li><li>this.async</li><li>this.cacheable</li><li>getOptions</li><li>validateOptions</li><li>addDependency</li></ul><hr><h3 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h3><ul><li><a href="https://babeljs.io/docs/en/babel-core/" target="_blank" rel="noopener">babel-core</a></li><li><a href="https://github.com/babel/babel-loader/blob/master/src/index.js" target="_blank" rel="noopener">babel-loader</a></li><li><p><a href="https://babeljs.io/docs/en/babel-plugin-transform-react-jsx/" target="_blank" rel="noopener">babel-plugin-transform-react-jsx</a></p></li><li><p>this.request=<code>/loaders/babel-loader.js!/src/index.js'</code></p></li><li>this.userRequest = <code>/src/index.js</code></li><li>this.rawRequest = <code>./src/index.js</code></li><li>this.resourcePath = <code>/src/index.js</code></li></ul><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> babel=<span class="built_in">require</span>(<span class="string">'babel-core'</span>);</span><br><span class="line"><span class="keyword">const</span> path=<span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=<span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="keyword">const</span> options = {</span><br><span class="line">        presets: [<span class="string">'env'</span>],</span><br><span class="line">        sourceMap: <span class="literal">true</span>,</span><br><span class="line">        filename:<span class="keyword">this</span>.request.split(<span class="string">'/'</span>).pop()</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">let</span> result=babel.transform(source,options);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.callback(<span class="literal">null</span>,result.code,result.map);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resolveLoader: {</span><br><span class="line">    alias: {</span><br><span class="line">      <span class="string">"babel-loader"</span>: resolve(<span class="string">'./build/babel-loader.js'</span>)</span><br><span class="line">    }</span><br><span class="line">},</span><br></pre></td></tr></tbody></table></figure><h3 id="BannerLoader"><a href="#BannerLoader" class="headerlink" title="BannerLoader"></a>BannerLoader</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="keyword">const</span> validateOptions = <span class="built_in">require</span>(<span class="string">'schema-utils'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="comment">//把loader改为异步,任务完成后需要手工执行callback</span></span><br><span class="line">    <span class="keyword">let</span> cb = <span class="keyword">this</span>.async();</span><br><span class="line">    <span class="comment">//启用loader缓存</span></span><br><span class="line">    <span class="keyword">this</span>.cacheable &amp;&amp; <span class="keyword">this</span>.cacheable();</span><br><span class="line">    <span class="comment">//用来验证options的合法性</span></span><br><span class="line">    <span class="keyword">let</span> schema = { </span><br><span class="line">        type: <span class="string">'object'</span>,</span><br><span class="line">        properties: {</span><br><span class="line">            filename: {</span><br><span class="line">                type: <span class="string">'string'</span></span><br><span class="line">            },</span><br><span class="line">            text: {</span><br><span class="line">                type: <span class="string">'string'</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//通过工具方法获取options</span></span><br><span class="line">    <span class="keyword">let</span> options = loaderUtils.getOptions(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//用来验证options的合法性</span></span><br><span class="line">    validateOptions(schema, options, <span class="string">'Banner-Loader'</span>);</span><br><span class="line">    <span class="keyword">let</span> { text, filename } = options;</span><br><span class="line">    <span class="keyword">if</span> (text) {</span><br><span class="line">        cb(<span class="literal">null</span>, text + source);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (filename) {</span><br><span class="line">        fs.readFile(filename, <span class="string">'utf8'</span>, (err, text) =&gt; {</span><br><span class="line">            cb(err, text + source);</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br></pre></td></tr></tbody></table></figure><p><code>banner.js</code><br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*zfpx*/</span></span><br></pre></td></tr></tbody></table></figure><p></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">options:{</span><br><span class="line">  filename:<span class="string">"./src/loaders/banner.js"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="pitch"><a href="#pitch" class="headerlink" title="pitch"></a>pitch</h2><blockquote><p>The loaders are called from right to left. But in some cases loaders do not care about the results of the previous loader or the resource. They only care for metadata. The pitch method on the loaders is called from left to right before the loaders are called. If a loader delivers a result in the pitch method the process turns around and skips the remaining loaders, continuing with the calls to the more left loaders. data can be passed between pitch and normal call.</p></blockquote><blockquote><p>In the complex case, when multiple loaders are chained, only the last loader gets the resource file and only the first loader is expected to give back one or two values (JavaScript and SourceMap). Values that any other loader give back are passed to the previous loader.</p></blockquote><ul><li>比如a!b!c!module, 正常调用顺序应该是c、b、a，但是真正调用顺序是 a(pitch)、b(pitch)、c(pitch)、c、b、a,如果其中任何一个pitching loader返回了值就相当于在它以及它右边的loader已经执行完毕</li><li>比如如果b返回了字符串”result b”, 接下来只有a会被系统执行，且a的loader收到的参数是result b</li><li>loader根据返回值可以分为两种，一种是返回js代码（一个module的代码，含有类似module.export语句）的loader，还有不能作为最左边loader的其他loader</li><li>有时候我们想把两个第一种loader chain起来，比如style-loader!css-loader! 问题是css-loader的返回值是一串js代码，如果按正常方式写style-loader的参数就是一串代码字符串</li><li>为了解决这种问题，我们需要在style-loader里执行require(css-loader!resouce)</li></ul><h3 id="pitch与loader本身方法的执行顺序图"><a href="#pitch与loader本身方法的执行顺序图" class="headerlink" title="pitch与loader本身方法的执行顺序图"></a>pitch与loader本身方法的执行顺序图</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">|- a-loader `pitch`</span><br><span class="line">  |- b-loader `pitch`</span><br><span class="line">    |- c-loader `pitch`</span><br><span class="line">      |- requested module is picked up as a dependency</span><br><span class="line">    |- c-loader normal execution</span><br><span class="line">  |- b-loader normal execution</span><br><span class="line">|- a-loader normal execution</span><br></pre></td></tr></tbody></table></figure><h3 id="log-loader1-js"><a href="#log-loader1-js" class="headerlink" title="log-loader1.js"></a>log-loader1.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//source就是接收到的源文件的内容</span></span><br><span class="line"><span class="keyword">let</span> loader = <span class="function"><span class="keyword">function</span> (<span class="params">source, sourceMaps, extra</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> cb = <span class="keyword">this</span>.async();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'loader1'</span>);</span><br><span class="line">    cb(<span class="literal">null</span>, source);</span><br><span class="line">}</span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br><span class="line">loader.pitch = <span class="function"><span class="keyword">function</span> (<span class="params">remainingRequest,previousRequest,data</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'pitch1'</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="log-loader2-js"><a href="#log-loader2-js" class="headerlink" title="log-loader2.js"></a>log-loader2.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//source就是接收到的源文件的内容</span></span><br><span class="line"><span class="keyword">let</span> loader = <span class="function"><span class="keyword">function</span> (<span class="params">source, sourceMaps, extra</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> cb = <span class="keyword">this</span>.async();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'loader2'</span>);</span><br><span class="line">    cb(<span class="literal">null</span>, source);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br><span class="line">loader.pitch = <span class="function"><span class="keyword">function</span> (<span class="params">remainingRequest,previousRequest,data</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'pitch2'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"2"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="log-loader3-js"><a href="#log-loader3-js" class="headerlink" title="log-loader3.js"></a>log-loader3.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//source就是接收到的源文件的内容</span></span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="keyword">let</span> loader = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> cb = <span class="keyword">this</span>.async();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'loader3'</span>);</span><br><span class="line">    cb(<span class="literal">null</span>, source);</span><br><span class="line">}</span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br><span class="line">loader.pitch = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'pitch3'</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">  use:[path.resolve(<span class="string">'src/loaders/log-loader1'</span>),path.resolve(<span class="string">'src/loaders/log-loader2'</span>),path.resolve(<span class="string">'src/loaders/log-loader3'</span>)]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="css"><a href="#css" class="headerlink" title="css"></a>css</h3><ul><li><a href="https://github.com/webpack-contrib/css-loader/blob/master/lib/loader.js" target="_blank" rel="noopener">css-loader</a> 的作用是处理css中的 @import 和 url 这样的外部资源</li><li><a href="https://github.com/webpack-contrib/style-loader/blob/master/index.js" target="_blank" rel="noopener">style-loader</a> 的作用是把样式插入到 DOM中，方法是在head中插入一个style标签，并把样式写入到这个标签的 innerHTML里</li><li><a href="https://github.com/webpack-contrib/less-loader" target="_blank" rel="noopener">less-loader</a> Compiles Less to CSS</li><li><a href="https://webpack.js.org/api/loaders/#pitching-loader" target="_blank" rel="noopener">pitching-loader</a></li><li><a href="https://github.com/webpack/loader-utils" target="_blank" rel="noopener">loader-utils</a></li><li><p><a href="https://webpack.js.org/concepts/loaders/#configuration" target="_blank" rel="noopener">!!</a></p></li><li><p>post(后置)+inline(内联)+normal(正常)+pre(前置)</p></li><li><p><code>!</code> noAutoLoaders 所有的普通loader都不要执行</p></li><li><code>!!</code> noPrePostAutoLoaders 不要前后置loader</li><li><code>-!</code> noPreAutoLoaders 不要前置loader</li></ul><h3 id="less-loader-js"><a href="#less-loader-js" class="headerlink" title="less-loader.js"></a>less-loader.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> less = <span class="built_in">require</span>(<span class="string">'less'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> callback = <span class="keyword">this</span>.async();</span><br><span class="line">    less.render(source, { <span class="attr">filename</span>: <span class="keyword">this</span>.resource }, (err, output) =&gt; {</span><br><span class="line">        <span class="keyword">this</span>.callback(err, output.css);</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>有些时间我们希望<code>less-loader</code>可以放在use数组最左边，最左边要求返回一个<code>JS脚本</code><br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> less=<span class="built_in">require</span>(<span class="string">'less'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=<span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>{</span><br><span class="line">  <span class="keyword">let</span> callback = <span class="keyword">this</span>.async();</span><br><span class="line">    less.render(source,(err,output) =&gt; {</span><br><span class="line">        callback(err, <span class="string">`module.exports = <span class="subst">${<span class="built_in">JSON</span>.stringify(output.css)}</span>`</span>);</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="css-loader-js"><a href="#css-loader-js" class="headerlink" title="css-loader.js"></a>css-loader.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><h3 id="style-loader"><a href="#style-loader" class="headerlink" title="style-loader"></a>style-loader</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> loaderUtils=<span class="built_in">require</span>(<span class="string">"loader-utils"</span>);</span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> script=(<span class="string">`</span></span><br><span class="line"><span class="string">      let style = document.createElement("style");</span></span><br><span class="line"><span class="string">      style.innerHTML = <span class="subst">${<span class="built_in">JSON</span>.stringify(source)}</span>;</span></span><br><span class="line"><span class="string">      document.head.appendChild(style);</span></span><br><span class="line"><span class="string">    `</span>);</span><br><span class="line">    <span class="keyword">return</span> script;</span><br><span class="line">} </span><br><span class="line"><span class="comment">//pitch里的参数可不是文件内容，而是文件的请求路径</span></span><br><span class="line"><span class="comment">//pitch request就是你要加载的文件路径 //index.less</span></span><br><span class="line">loader.pitch = <span class="function"><span class="keyword">function</span> (<span class="params">request</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> style = <span class="string">`</span></span><br><span class="line"><span class="string">    var style = document.createElement("style");</span></span><br><span class="line"><span class="string">    style.innerHTML = require(<span class="subst">${loaderUtils.stringifyRequest(<span class="keyword">this</span>, <span class="string">"!!"</span> + request)}</span>);</span></span><br><span class="line"><span class="string">    document.head.appendChild(style);</span></span><br><span class="line"><span class="string"> `</span>;</span><br><span class="line">    <span class="keyword">return</span> style;</span><br><span class="line">}</span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br></pre></td></tr></tbody></table></figure><h3 id="bundle"><a href="#bundle" class="headerlink" title="bundle"></a>bundle</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line"> <span class="string">"./loaders/css-loader.js!./loaders/less-loader.js!./src/index.less"</span>:</span><br><span class="line"><span class="comment">/*!*************************************************************************!*\</span></span><br><span class="line"><span class="comment">  !*** ./loaders/css-loader.js!./loaders/less-loader.js!./src/index.less ***!</span></span><br><span class="line"><span class="comment">  \*************************************************************************/</span></span><br><span class="line"> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>{</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"let lists = [];\r\nlists.push(\"div {\\n  color: red;\\n}\\nbody {\\n  background: \")\r\nlists.push(\"url(\"+__webpack_require__(/*! ./baidu.png */ \"./src/baidu.png\")+\")\")\r\nlists.push(\";\\n}\\n\")\r\nmodule.exports = lists.join('')\n\n//# sourceURL=webpack:///./src/index.less?./loaders/css-loader.js!./loaders/less-loader.js"</span>);</span><br><span class="line"></span><br><span class="line"> }),</span><br><span class="line"> <span class="string">"./src/baidu.png"</span>:</span><br><span class="line"> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>{</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"module.exports = __webpack_require__.p + \"b15c113aeddbeb606d938010b88cf8e6.png\";\n\n//# sourceURL=webpack:///./src/baidu.png?"</span>);</span><br><span class="line"> }),</span><br><span class="line"> <span class="string">"./src/index.js"</span>:</span><br><span class="line"> (<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>{</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _index_less__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./index.less */ \"./src/index.less\");\n/* harmony import */ var _index_less__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_index_less__WEBPACK_IMPORTED_MODULE_0__);\n\n\n//# sourceURL=webpack:///./src/index.js?"</span>);</span><br><span class="line"> }),</span><br><span class="line"> <span class="string">"./src/index.less"</span>:</span><br><span class="line"> (<span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>) </span>{</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"\n    var style = document.createElement(\"style\");\n    style.innerHTML = __webpack_require__(/*! !../loaders/css-loader.js!../loaders/less-loader.js!./index.less */ \"./loaders/css-loader.js!./loaders/less-loader.js!./src/index.less\");\n    document.head.appendChild(style);\n \n\n//# sourceURL=webpack:///./src/index.less?"</span>);</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure><h3 id="exact-loader-js"><a href="#exact-loader-js" class="headerlink" title="exact-loader.js"></a>exact-loader.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把CSS文件单独放置到一个文件中去，然后在页面中通过link标签去引入</span></span><br><span class="line"><span class="keyword">let</span> loader = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="comment">//发射或者说输出一个文件，这个文件的内容 就是css文件的内容</span></span><br><span class="line">    <span class="keyword">this</span>.emitFile(<span class="string">'main.css'</span>, source);</span><br><span class="line">    <span class="keyword">let</span> script = <span class="string">`</span></span><br><span class="line"><span class="string">     let link  = document.createElement('link');</span></span><br><span class="line"><span class="string">     link.setAttribute('rel','stylesheet');</span></span><br><span class="line"><span class="string">     link.setAttribute('href','main.css');</span></span><br><span class="line"><span class="string">     document.head.appendChild(link);</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line">    <span class="keyword">return</span> script;</span><br><span class="line">}</span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br></pre></td></tr></tbody></table></figure><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p><code>file-loader</code> 并不会对文件内容进行任何转换，只是复制一份文件内容，并根据配置为他生成一个唯一的文件名。</p><h4 id="file-loader"><a href="#file-loader" class="headerlink" title="file-loader"></a>file-loader</h4><ul><li><a href="https://github.com/webpack-contrib/file-loader/blob/master/src/index.js" target="_blank" rel="noopener">file-loader</a></li><li><a href="https://webpack.js.org/guides/public-path/#on-the-fly" target="_blank" rel="noopener">public-path</a></li></ul><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> { getOptions, interpolateName } = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">content</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> options=getOptions(<span class="keyword">this</span>)||{};</span><br><span class="line">    <span class="keyword">let</span> url = interpolateName(<span class="keyword">this</span>, options.filename || <span class="string">"[hash]"</span>, {content});</span><br><span class="line">    url = url  + <span class="keyword">this</span>.resourcePath.slice(<span class="keyword">this</span>.resourcePath.lastIndexOf(<span class="string">'.'</span>));</span><br><span class="line">    <span class="comment">//发射一个文件 向输出里保存一个文件</span></span><br><span class="line">    <span class="keyword">this</span>.emitFile(url, content);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`module.exports = <span class="subst">${<span class="built_in">JSON</span>.stringify(url)}</span>`</span>;</span><br><span class="line">}</span><br><span class="line">loader.raw = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br></pre></td></tr></tbody></table></figure><ul><li>通过 <code>loaderUtils.interpolateName</code> 方法可以根据 <code>options.name</code> 以及文件内容生成一个唯一的文件名 <code>url</code>（一般配置都会带上hash，否则很可能由于文件重名而冲突）</li><li>通过 <code>this.emitFile(url, content)</code> 告诉 webpack 我需要创建一个文件，webpack会根据参数创建对应的文件，放在 <code>public path</code> 目录下</li><li>返回 <code>module.exports = ${JSON.stringify(url)}</code>,这样就会把原来的文件路径替换为编译后的路径</li></ul><h3 id="url-loader"><a href="#url-loader" class="headerlink" title="url-loader"></a>url-loader</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> { getOptions } = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="keyword">var</span> mime = <span class="built_in">require</span>(<span class="string">'mime'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> options=getOptions(<span class="keyword">this</span>)||{};</span><br><span class="line">    <span class="keyword">let</span> { limit, fallback=<span class="string">'file-loader'</span> } = options;</span><br><span class="line">    <span class="keyword">if</span> (limit) {</span><br><span class="line">      limit = <span class="built_in">parseInt</span>(limit, <span class="number">10</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">const</span> mimetype=mime.getType(<span class="keyword">this</span>.resourcePath);</span><br><span class="line">    <span class="keyword">if</span> (!limit || source.length &lt; limit) {</span><br><span class="line">        <span class="keyword">let</span> base64 = <span class="string">`data:<span class="subst">${mimetype}</span>;base64,<span class="subst">${source.toString(<span class="string">'base64'</span>)}</span>`</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`module.exports = <span class="subst">${<span class="built_in">JSON</span>.stringify(base64)}</span>`</span>;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">let</span> fileLoader = <span class="built_in">require</span>(fallback || <span class="string">'file-loader'</span>);</span><br><span class="line">        <span class="keyword">return</span> fileLoader.call(<span class="keyword">this</span>, source);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">loader.raw = <span class="literal">true</span>;</span><br><span class="line"><span class="built_in">module</span>.exports = loader;</span><br></pre></td></tr></tbody></table></figure><h3 id="html-layout-loader"><a href="#html-layout-loader" class="headerlink" title="html-layout-loader"></a>html-layout-loader</h3><h4 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  test: <span class="regexp">/\.html$/</span>,</span><br><span class="line">     use: {</span><br><span class="line">          loader: <span class="string">'html-layout-loader'</span>,</span><br><span class="line">          options: {</span><br><span class="line">              layout: path.join(__dirname, <span class="string">'src'</span>, <span class="string">'layout.html'</span>),</span><br><span class="line">              placeholder: <span class="string">'{{__content__}}'</span></span><br><span class="line">     }</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin({</span><br><span class="line">            template: <span class="string">'./src/login.html'</span>,</span><br><span class="line">            filename: <span class="string">'login.html'</span></span><br><span class="line">        }),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin({</span><br><span class="line">            template: <span class="string">'./src/home.html'</span>,</span><br><span class="line">            filename: <span class="string">'home.html'</span></span><br><span class="line">        })</span><br><span class="line">]</span><br></pre></td></tr></tbody></table></figure><h4 id="html-layout-loader-1"><a href="#html-layout-loader-1" class="headerlink" title="html-layout-loader"></a>html-layout-loader</h4><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="keyword">const</span> defaultOptions = {</span><br><span class="line">    placeholder: <span class="string">'{{__content__}}'</span>,</span><br><span class="line">    decorator: <span class="string">'layout'</span></span><br><span class="line">}</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">source</span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> callback = <span class="keyword">this</span>.async();</span><br><span class="line">    <span class="keyword">this</span>.cacheable &amp;&amp; <span class="keyword">this</span>.cacheable();</span><br><span class="line">    <span class="keyword">const</span> options = <span class="built_in">Object</span>.assign(loaderUtils.getOptions(<span class="keyword">this</span>), defaultOptions);</span><br><span class="line">    <span class="keyword">const</span> { placeholder, decorator, layout } = options;</span><br><span class="line">    fs.readFile(layout, <span class="string">'utf8'</span>, (err, html) =&gt; {</span><br><span class="line">        html = html.replace(placeholder, source);</span><br><span class="line">        callback(<span class="literal">null</span>, <span class="string">`module.exports = <span class="subst">${<span class="built_in">JSON</span>.stringify(html)}</span>`</span>);</span><br><span class="line">    })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> loaderUtils = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="keyword">const</span> defaultOptions = {</span><br><span class="line">    placeholder:<span class="string">'{{__content__}}'</span>,</span><br><span class="line">    decorator:<span class="string">'layout'</span></span><br><span class="line">}</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">source</span>)</span>{</span><br><span class="line">    <span class="keyword">let</span> callback = <span class="keyword">this</span>.async();</span><br><span class="line">    <span class="keyword">this</span>.cacheable&amp;&amp; <span class="keyword">this</span>.cacheable();</span><br><span class="line">    <span class="keyword">const</span> options = {...loaderUtils.getOptions(<span class="keyword">this</span>),...defaultOptions};</span><br><span class="line">    <span class="keyword">const</span> {placeholder,layout,decorator} = options;</span><br><span class="line">    <span class="keyword">const</span> layoutReg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">`@<span class="subst">${decorator}</span>\\((.+?)\\)`</span>);</span><br><span class="line">    <span class="keyword">let</span> result = source.match(layoutReg);</span><br><span class="line">    <span class="keyword">if</span>(result){</span><br><span class="line">        source = source.replace(result[<span class="number">0</span>],<span class="string">''</span>);</span><br><span class="line">        render(path.resolve(<span class="keyword">this</span>.context,result[<span class="number">1</span>]), placeholder, source, callback)</span><br><span class="line">    }<span class="keyword">else</span>{</span><br><span class="line">        render(layout, placeholder, source, callback);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">layout, placeholder, source, callback</span>) </span>{</span><br><span class="line">    fs.readFile(layout, <span class="string">'utf8'</span>, (err, html) =&gt; {</span><br><span class="line">        html = html.replace(placeholder, source);</span><br><span class="line">        callback(<span class="literal">null</span>, <span class="string">`module.exports = <span class="subst">${<span class="built_in">JSON</span>.stringify(html)}</span>`</span>);</span><br><span class="line">    })</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="loader测试"><a href="#loader测试" class="headerlink" title="loader测试"></a>loader测试</h2><h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cnpm install --save-dev jest babel-jest babel-preset-env</span><br><span class="line">cnpm install --save-dev webpack memory-fs</span><br></pre></td></tr></tbody></table></figure><h3 id="src-loader-js"><a href="#src-loader-js" class="headerlink" title="src/loader.js"></a>src/loader.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> {getOptions} = <span class="built_in">require</span>(<span class="string">'loader-utils'</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>{</span><br><span class="line">   <span class="keyword">const</span> options = getOptions(<span class="keyword">this</span>);</span><br><span class="line">   source=source.replace(<span class="regexp">/\[name\]/g</span>,options.name);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">`module.exports = <span class="subst">${<span class="built_in">JSON</span>.stringify(source)}</span>`</span>;</span><br><span class="line">}</span><br><span class="line"><span class="built_in">module</span>.exports=loader;</span><br></pre></td></tr></tbody></table></figure><h3 id="test-example-txt"><a href="#test-example-txt" class="headerlink" title="test/example.txt"></a>test/example.txt</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello [name]</span><br></pre></td></tr></tbody></table></figure><h3 id="test-compile-js"><a href="#test-compile-js" class="headerlink" title="test/compile.js"></a>test/compile.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path=<span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack=<span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">let</span> MemoryFs=<span class="built_in">require</span>(<span class="string">'memory-fs'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">fixture,options={}</span>) </span>{</span><br><span class="line">    <span class="keyword">const</span> compiler=webpack({</span><br><span class="line">        mode:<span class="string">'development'</span>,</span><br><span class="line">        context: __dirname,</span><br><span class="line">        entry: <span class="string">`./<span class="subst">${fixture}</span>`</span>,</span><br><span class="line">        output: {</span><br><span class="line">            path: path.resolve(__dirname),</span><br><span class="line">            filename:<span class="string">'bundle.js'</span></span><br><span class="line">        },</span><br><span class="line">        <span class="built_in">module</span>: {</span><br><span class="line">            rules: [</span><br><span class="line">                {</span><br><span class="line">                    test: <span class="regexp">/\.txt$/</span>,</span><br><span class="line">                    use: {</span><br><span class="line">                        loader: path.resolve(__dirname,<span class="string">'../src/loader.js'</span>),</span><br><span class="line">                        options:{<span class="attr">name</span>:<span class="string">'Alice'</span>}</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            ]</span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line">    compiler.outputFileSystem=<span class="keyword">new</span> MemoryFs();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>{</span><br><span class="line">        compiler.run(<span class="function">(<span class="params">err,stats</span>) =&gt;</span> {</span><br><span class="line">            <span class="keyword">if</span> (err) reject(err);</span><br><span class="line">            <span class="keyword">else</span> resolve(stats);</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="test-loader-test-js"><a href="#test-loader-test-js" class="headerlink" title="test/loader.test.js"></a>test/loader.test.js</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> compile=<span class="built_in">require</span>(<span class="string">'./compile'</span>);</span><br><span class="line">test(<span class="string">'replace name'</span>,<span class="keyword">async</span> () =&gt; {</span><br><span class="line">    <span class="keyword">const</span> stats=<span class="keyword">await</span> compile(<span class="string">'example.txt'</span>);</span><br><span class="line">    <span class="keyword">const</span> data=stats.toJson();</span><br><span class="line">    <span class="keyword">const</span> source=data.modules[<span class="number">0</span>].source;</span><br><span class="line">    expect(source).toBe(<span class="string">`module.exports = "hello Alice"`</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: {</span><br><span class="line">  <span class="string">"test"</span>:<span class="string">"jest"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="loader源码"><a href="#loader源码" class="headerlink" title="loader源码"></a>loader源码</h3><p>loader是用来加载处理各种形式的资源,本质上是一个函数, 接受文件作为参数,返回转化后的结构。</p><ul><li>loader 用于对模块的源代码进行转换</li><li>loader 可以使你在 import 或”加载”模块时预处理文件</li></ul><h4 id="NormalModuleFactory"><a href="#NormalModuleFactory" class="headerlink" title="NormalModuleFactory"></a>NormalModuleFactory</h4><ul><li><code>!</code> noAutoLoaders 所有的loader都不要执行</li><li><code>!!</code> noPrePostAutoLoaders 不要前后置loader</li><li><code>-!</code> noPreAutoLoaders 不要前置loader</li></ul><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.hooks.resolver.tap(<span class="string">"NormalModuleFactory"</span>, () =&gt; <span class="function">(<span class="params">data, callback</span>) =&gt;</span> {</span><br><span class="line">            <span class="keyword">const</span> contextInfo = data.contextInfo;</span><br><span class="line">            <span class="keyword">const</span> context = data.context;</span><br><span class="line">            <span class="keyword">const</span> request = data.request;</span><br><span class="line">            <span class="keyword">debugger</span> <span class="comment">/*resolve钩子上注册的方法较长，其中还包括了模块资源本身的路径解析。resolver有两种，分别是loaderResolver和normalResolver。*/</span></span><br><span class="line">            <span class="keyword">const</span> loaderResolver = <span class="keyword">this</span>.getResolver(<span class="string">"loader"</span>);</span><br><span class="line">            <span class="keyword">const</span> normalResolver = <span class="keyword">this</span>.getResolver(<span class="string">"normal"</span>, data.resolveOptions);</span><br><span class="line">            <span class="comment">//匹配的资源</span></span><br><span class="line">            <span class="keyword">let</span> matchResource = <span class="literal">undefined</span>;</span><br><span class="line">            <span class="keyword">let</span> requestWithoutMatchResource = request;<span class="comment">//这是原始的请求</span></span><br><span class="line">            <span class="keyword">const</span> matchResourceMatch = MATCH_RESOURCE_REGEX.exec(request);<span class="comment">//"^([^!]+)!=!"</span></span><br><span class="line">            <span class="keyword">if</span> (matchResourceMatch) {<span class="comment">//如果能匹配上</span></span><br><span class="line">                matchResource = matchResourceMatch[<span class="number">1</span>];<span class="comment">//取得匹配到的资源 </span></span><br><span class="line">                <span class="keyword">if</span> (<span class="regexp">/^\.\.?\//</span>.test(matchResource)) {<span class="comment">//如果是一个相对路径,则转成绝对路径</span></span><br><span class="line">                    matchResource = path.join(context, matchResource);</span><br><span class="line">                }<span class="comment">//把匹配到的部分截取掉</span></span><br><span class="line">                requestWithoutMatchResource = request.substr(</span><br><span class="line">                    matchResourceMatch[<span class="number">0</span>].length</span><br><span class="line">                );</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">debugger</span> <span class="comment">/*noPreAuto指的是只用行内loader,禁用配置文件中的loader配置*/</span></span><br><span class="line">            <span class="keyword">const</span> noPreAutoLoaders = requestWithoutMatchResource.startsWith(<span class="string">"-!"</span>);</span><br><span class="line">            <span class="keyword">const</span> noAutoLoaders =</span><br><span class="line">                noPreAutoLoaders || requestWithoutMatchResource.startsWith(<span class="string">"!"</span>);<span class="comment">//!表示不走配置</span></span><br><span class="line">            <span class="keyword">const</span> noPrePostAutoLoaders = requestWithoutMatchResource.startsWith(<span class="string">"!!"</span>);<span class="comment">//表示禁用前后loader</span></span><br><span class="line">            <span class="keyword">let</span> elements = requestWithoutMatchResource</span><br><span class="line">                .replace(<span class="regexp">/^-?!+/</span>, <span class="string">""</span>)<span class="comment">//把-!替换成空</span></span><br><span class="line">                .replace(<span class="regexp">/!!+/g</span>, <span class="string">"!"</span>)<span class="comment">//把!!替换成一个!</span></span><br><span class="line">                .split(<span class="string">"!"</span>); <span class="keyword">debugger</span> <span class="comment">/*webpack会从request中解析出所需的loader,包括资源本身 */</span></span><br><span class="line">            <span class="keyword">let</span> resource = elements.pop();<span class="comment">//取得资源</span></span><br><span class="line">            elements = elements.map(identToLoaderRequest);<span class="comment">//剩下的全转成loader对象</span></span><br></pre></td></tr></tbody></table></figure><h3 id="webpack-lib-NormalModule-js-263"><a href="#webpack-lib-NormalModule-js-263" class="headerlink" title="webpack/lib/NormalModule.js:263"></a>webpack/lib/NormalModule.js:263</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">runLoaders({</span><br><span class="line">                resource: <span class="keyword">this</span>.resource,</span><br><span class="line">                loaders: <span class="keyword">this</span>.loaders,</span><br><span class="line">                context: loaderContext</span><br><span class="line">},</span><br><span class="line">(err, result) =&gt; {</span><br><span class="line"><span class="keyword">const</span> resourceBuffer = result.resourceBuffer;</span><br><span class="line"><span class="keyword">const</span> source = result.result[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">const</span> sourceMap = result.result.length &gt;= <span class="number">1</span> ? result.result[<span class="number">1</span>] : <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">const</span> extraInfo = result.result.length &gt;= <span class="number">2</span> ? result.result[<span class="number">2</span>] : <span class="literal">null</span>;<span class="comment">//ast</span></span><br><span class="line"><span class="keyword">this</span>._source = <span class="keyword">this</span>.createSource(</span><br><span class="line">                    <span class="keyword">this</span>.binary ? asBuffer(source) : asString(source),</span><br><span class="line">                    resourceBuffer,</span><br><span class="line">                    sourceMap</span><br><span class="line">);</span><br><span class="line"><span class="keyword">this</span>._ast = <span class="keyword">typeof</span> extraInfo === <span class="string">"object"</span> &amp;&amp;</span><br><span class="line">                    extraInfo !== <span class="literal">null</span> &amp;&amp;</span><br><span class="line">                    extraInfo.webpackAST !== <span class="literal">undefined</span>? extraInfo.webpackAST: <span class="literal">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="LoaderRunner-js"><a href="#LoaderRunner-js" class="headerlink" title="LoaderRunner.js"></a>LoaderRunner.js</h3><p>loader-runner/lib/LoaderRunner.js<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">iteratePitchingLoaders(processOptions, loaderContext, <span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>{</span><br><span class="line">callback(<span class="literal">null</span>, {</span><br><span class="line">            result: result,<span class="comment">//结果</span></span><br><span class="line">            resourceBuffer: processOptions.resourceBuffer,</span><br><span class="line">            cacheable: requestCacheable,</span><br><span class="line">            fileDependencies: fileDependencies,</span><br><span class="line">            contextDependencies: contextDependencies</span><br><span class="line">});</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="LoaderRunner-js-155"><a href="#LoaderRunner-js-155" class="headerlink" title="LoaderRunner.js:155"></a>LoaderRunner.js:155</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(loaderContext.loaderIndex &gt;= loaderContext.loaders.length)</span><br><span class="line">        <span class="keyword">return</span> processResource(options, loaderContext, callback);</span><br><span class="line"><span class="keyword">var</span> fn = currentLoaderObject.pitch;</span><br><span class="line"></span><br><span class="line">runSyncOrAsync(fn,loaderContext);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runSyncOrAsync</span>(<span class="params">fn, context, args, callback</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> isSync = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">var</span> isDone = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> isError = <span class="literal">false</span>; <span class="comment">// internal error</span></span><br><span class="line">    <span class="keyword">var</span> reportedError = <span class="literal">false</span>;</span><br><span class="line">    context.async = <span class="function"><span class="keyword">function</span> <span class="title">async</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">if</span> (isDone) {</span><br><span class="line">            <span class="keyword">if</span> (reportedError) <span class="keyword">return</span>; <span class="comment">// ignore</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"async(): The callback was already called."</span>);</span><br><span class="line">        }</span><br><span class="line">        isSync = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> innerCallback;</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">var</span> innerCallback = context.callback = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">        <span class="keyword">if</span> (isDone) {</span><br><span class="line">            <span class="keyword">if</span> (reportedError) <span class="keyword">return</span>; <span class="comment">// ignore</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"callback(): The callback was already called."</span>);</span><br><span class="line">        }</span><br><span class="line">        isDone = <span class="literal">true</span>;</span><br><span class="line">        isSync = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            callback.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        } <span class="keyword">catch</span> (e) {</span><br><span class="line">            isError = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">var</span> result = (<span class="function"><span class="keyword">function</span> <span class="title">LOADER_EXECUTION</span>(<span class="params"></span>) </span>{</span><br><span class="line">            <span class="keyword">return</span> fn.apply(context, args);</span><br><span class="line">        }());</span><br><span class="line">        <span class="keyword">if</span> (isSync) {</span><br><span class="line">            isDone = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (result === <span class="literal">undefined</span>)</span><br><span class="line">                <span class="keyword">return</span> callback();</span><br><span class="line">            <span class="keyword">if</span> (result &amp;&amp; <span class="keyword">typeof</span> result === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> result.then === <span class="string">"function"</span>) {</span><br><span class="line">                <span class="keyword">return</span> result.catch(callback).then(<span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>{</span><br><span class="line">                    callback(<span class="literal">null</span>, r);</span><br><span class="line">                });</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> callback(<span class="literal">null</span>, result);</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">catch</span> (e) {</span><br><span class="line">        <span class="keyword">if</span> (isError) <span class="keyword">throw</span> e;</span><br><span class="line">        <span class="keyword">if</span> (isDone) {</span><br><span class="line">            <span class="comment">// loader is already "done", so we cannot use the callback function</span></span><br><span class="line">            <span class="comment">// for better debugging we print the error on the console</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> e === <span class="string">"object"</span> &amp;&amp; e.stack) <span class="built_in">console</span>.error(e.stack);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">console</span>.error(e);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        isDone = <span class="literal">true</span>;</span><br><span class="line">        reportedError = <span class="literal">true</span>;</span><br><span class="line">        callback(e);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runSyncOrAsync</span>(<span class="params">fn, context, callback</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> isSync = <span class="literal">true</span>;</span><br><span class="line">    context.callback = callback;</span><br><span class="line">    context.async = <span class="function"><span class="keyword">function</span> <span class="title">async</span>(<span class="params"></span>) </span>{</span><br><span class="line">        isSync = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> context.callback;</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = fn.apply(context);</span><br><span class="line">    <span class="keyword">if</span> (isSync) {</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="literal">null</span>, result);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say2</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">let</span> cb = <span class="keyword">this</span>.async();</span><br><span class="line">    cb(<span class="literal">null</span>);</span><br><span class="line">}</span><br><span class="line"><span class="keyword">let</span> context = { <span class="attr">name</span>: <span class="string">'zfpx'</span> };</span><br><span class="line">runSyncOrAsync(say2, context, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'over'</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><h3 id="loadLoader-js-13"><a href="#loadLoader-js-13" class="headerlink" title="loadLoader.js:13"></a>loadLoader.js:13</h3><p>loader-runner/lib/loadLoader.js:13<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = <span class="built_in">require</span>(loader.path);</span><br><span class="line">loader.normal = <span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">"function"</span> ? <span class="built_in">module</span> : <span class="built_in">module</span>.default;</span><br><span class="line">loader.pitch = <span class="built_in">module</span>.pitch;</span><br><span class="line">loader.raw = <span class="built_in">module</span>.raw;</span><br></pre></td></tr></tbody></table></figure><p></p><h3 id="LoaderRunner-js-1"><a href="#LoaderRunner-js-1" class="headerlink" title="LoaderRunner.js"></a>LoaderRunner.js</h3><p>loader-runner/lib/LoaderRunner.js<br></p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">runSyncOrAsync(</span><br><span class="line">            fn,</span><br><span class="line">            loaderContext, [loaderContext.remainingRequest, loaderContext.previousRequest, currentLoaderObject.data = {}],</span><br><span class="line">            <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{</span><br><span class="line">                <span class="keyword">if</span>(err) <span class="keyword">return</span> callback(err);</span><br><span class="line">                <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(args.length &gt; <span class="number">0</span>) {</span><br><span class="line">                    loaderContext.loaderIndex--;</span><br><span class="line">                    iterateNormalLoaders(options, loaderContext, args, callback);</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    iteratePitchingLoaders(options, loaderContext, callback);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        );</span><br></pre></td></tr></tbody></table></figure><p></p><hr><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://github.com/webpack/loader-utils" target="_blank" rel="noopener">loader-utils</a></li><li><a href="https://github.com/webpack-contrib/schema-utils" target="_blank" rel="noopener">schema-utils</a></li></ul></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>喜欢我记的打赏额</div><button id="rewardButton" disable="enable" onclick='var qr=document.getElementById("QR");"none"===qr.style.display?qr.style.display="block":qr.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/person_blogs/uploads/wechatpay.jpg" alt="dapeng 微信支付"><p>微信支付</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/webpack/" rel="tag"># webpack</a> <a href="/tags/loader/" rel="tag"># loader</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/01/14/AST/" rel="next" title="AST"><i class="fa fa-chevron-left"></i> AST</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2019/01/21/plugin/" rel="prev" title="plugin">plugin <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC8zNjU3My8xMzEwOA=="></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/uploads/avatar.jpg" alt="dapeng"><p class="site-author-name" itemprop="name">dapeng</p><p class="site-description motion-element" itemprop="description">人生不止眼前的苟且，还有诗和远方的田野</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">61</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">62</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zhangyapeng0222" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:48283450@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#loader运行的总体流程-一个函数"><span class="nav-number">1.</span> <span class="nav-text">loader运行的总体流程(一个函数)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#loader配置"><span class="nav-number">2.</span> <span class="nav-text">loader配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#匹配-test-单个-loader"><span class="nav-number">2.1.</span> <span class="nav-text">匹配(test)单个 loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#匹配-test-多个-loaders"><span class="nav-number">2.2.</span> <span class="nav-text">匹配(test)多个 loaders</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#npm-link"><span class="nav-number">2.3.</span> <span class="nav-text">npm link</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#alias"><span class="nav-number">2.4.</span> <span class="nav-text">alias</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#loader用法"><span class="nav-number">3.</span> <span class="nav-text">loader用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单个loader用法"><span class="nav-number">3.1.</span> <span class="nav-text">单个loader用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多个loader"><span class="nav-number">3.2.</span> <span class="nav-text">多个loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单个loader用法-1"><span class="nav-number">3.3.</span> <span class="nav-text">单个loader用法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用法准则"><span class="nav-number">4.</span> <span class="nav-text">用法准则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简单"><span class="nav-number">4.1.</span> <span class="nav-text">简单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#链式-Chaining"><span class="nav-number">4.2.</span> <span class="nav-text">链式(Chaining)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块化-Modular"><span class="nav-number">4.3.</span> <span class="nav-text">模块化(Modular)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#无状态-Stateless"><span class="nav-number">4.4.</span> <span class="nav-text">无状态(Stateless)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loader-工具库-Loader-Utilities"><span class="nav-number">4.5.</span> <span class="nav-text">loader 工具库(Loader Utilities)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loader-依赖-Loader-Dependencies"><span class="nav-number">4.6.</span> <span class="nav-text">loader 依赖(Loader Dependencies)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块依赖-Module-Dependencies"><span class="nav-number">4.7.</span> <span class="nav-text">模块依赖(Module Dependencies)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#绝对路径-Absolute-Paths"><span class="nav-number">4.8.</span> <span class="nav-text">绝对路径(Absolute Paths)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#同等依赖-Peer-Dependencies"><span class="nav-number">4.9.</span> <span class="nav-text">同等依赖(Peer Dependencies)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API"><span class="nav-number">5.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存结果"><span class="nav-number">5.1.</span> <span class="nav-text">缓存结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异步"><span class="nav-number">5.2.</span> <span class="nav-text">异步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#raw-loader"><span class="nav-number">5.3.</span> <span class="nav-text">raw loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获得-Loader-的-options"><span class="nav-number">5.4.</span> <span class="nav-text">获得 Loader 的 options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#返回其它结果"><span class="nav-number">5.5.</span> <span class="nav-text">返回其它结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#同步与异步"><span class="nav-number">5.6.</span> <span class="nav-text">同步与异步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#处理二进制数据"><span class="nav-number">5.7.</span> <span class="nav-text">处理二进制数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#缓存"><span class="nav-number">5.8.</span> <span class="nav-text">缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其它-Loader-API"><span class="nav-number">5.9.</span> <span class="nav-text">其它 Loader API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#loader实战"><span class="nav-number">6.</span> <span class="nav-text">loader实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#babel-loader"><span class="nav-number">6.1.</span> <span class="nav-text">babel-loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BannerLoader"><span class="nav-number">6.2.</span> <span class="nav-text">BannerLoader</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pitch"><span class="nav-number">7.</span> <span class="nav-text">pitch</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pitch与loader本身方法的执行顺序图"><span class="nav-number">7.1.</span> <span class="nav-text">pitch与loader本身方法的执行顺序图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#log-loader1-js"><span class="nav-number">7.2.</span> <span class="nav-text">log-loader1.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#log-loader2-js"><span class="nav-number">7.3.</span> <span class="nav-text">log-loader2.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#log-loader3-js"><span class="nav-number">7.4.</span> <span class="nav-text">log-loader3.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#css"><span class="nav-number">7.5.</span> <span class="nav-text">css</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#less-loader-js"><span class="nav-number">7.6.</span> <span class="nav-text">less-loader.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#css-loader-js"><span class="nav-number">7.7.</span> <span class="nav-text">css-loader.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#style-loader"><span class="nav-number">7.8.</span> <span class="nav-text">style-loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bundle"><span class="nav-number">7.9.</span> <span class="nav-text">bundle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exact-loader-js"><span class="nav-number">7.10.</span> <span class="nav-text">exact-loader.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#file"><span class="nav-number">7.11.</span> <span class="nav-text">file</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#file-loader"><span class="nav-number">7.11.1.</span> <span class="nav-text">file-loader</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#url-loader"><span class="nav-number">7.12.</span> <span class="nav-text">url-loader</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#html-layout-loader"><span class="nav-number">7.13.</span> <span class="nav-text">html-layout-loader</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#webpack-config-js"><span class="nav-number">7.13.1.</span> <span class="nav-text">webpack.config.js</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#html-layout-loader-1"><span class="nav-number">7.13.2.</span> <span class="nav-text">html-layout-loader</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#loader测试"><span class="nav-number">8.</span> <span class="nav-text">loader测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#安装依赖"><span class="nav-number">8.1.</span> <span class="nav-text">安装依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#src-loader-js"><span class="nav-number">8.2.</span> <span class="nav-text">src/loader.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#test-example-txt"><span class="nav-number">8.3.</span> <span class="nav-text">test/example.txt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#test-compile-js"><span class="nav-number">8.4.</span> <span class="nav-text">test/compile.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#test-loader-test-js"><span class="nav-number">8.5.</span> <span class="nav-text">test/loader.test.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#package-json"><span class="nav-number">8.6.</span> <span class="nav-text">package.json</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loader源码"><span class="nav-number">8.7.</span> <span class="nav-text">loader源码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#NormalModuleFactory"><span class="nav-number">8.7.1.</span> <span class="nav-text">NormalModuleFactory</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpack-lib-NormalModule-js-263"><span class="nav-number">8.8.</span> <span class="nav-text">webpack/lib/NormalModule.js:263</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LoaderRunner-js"><span class="nav-number">8.9.</span> <span class="nav-text">LoaderRunner.js</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LoaderRunner-js-155"><span class="nav-number">8.10.</span> <span class="nav-text">LoaderRunner.js:155</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loadLoader-js-13"><span class="nav-number">8.11.</span> <span class="nav-text">loadLoader.js:13</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LoaderRunner-js-1"><span class="nav-number">8.12.</span> <span class="nav-text">LoaderRunner.js</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">9.</span> <span class="nav-text">参考</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">© <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">dapeng</span></div><div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div><span class="post-meta-divider">|</span><div class="theme-info">主题 — <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/velocity/1.2.1/velocity.ui.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js"></script><script type="text/javascript" src="https://cdn.bootcss.com/canvas-nest.js/1.0.1/canvas-nest.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script type="text/javascript" src="/bundle.js"></script><script type="text/javascript">(function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    ;

    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  ;
AV.initialize("xb0CD6LXpsiWakv1vqqGvArr-gzGzoHsz", "QY6l9v7TBktnoVFXmbUGUvkW");;

    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  ;

    
    
      flOptions = {};
      
          flOptions.iconStyle = "defalut";
      
          flOptions.boxForm = "vertical";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Weibo,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  ;
L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hibiki.model.json"},"display":{"position":"left","width":150,"height":500},"mobile":{"show":false},"log":false});</script><script async>window.onload=function(){var e=document.createElement("script"),t=document.getElementsByTagName("script")[0];e.type="text/javascript",e.async=!0,e.src="/sw-register.js?v="+Date.now(),t.parentNode.insertBefore(e,t)}</script></body></html>